<?xml version="1.0" encoding="ISO-8859-1"?>
<SunopsisExport>
<Admin RepositoryVersion="05.02.02.09" IsLegacyIdCompatible="false" />
<Encryption algorithm="AES" keyLength="128" exportKeyHash="x3TQVV4HK8/1RRr7xQoFP4mJfGtshSqBL9l7ZPEEiCQ=" keyVect="DT4xlW6BVt6mwXsklc6esQ==" exportKeySalt="b8aef1cf-258d-49a0-b643-7557baa7acdb" containsCipherText="false"/>
<Object class="com.sunopsis.dwg.dbobj.SnpScen">
		<Field name="CecSessBehavior" type="java.lang.String">null</Field>
	<Field name="CecSessPollIntv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ExtVersion" type="java.lang.String">null</Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2022-06-06 20:14:26.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[TST_MPEROTA]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fc19948d-3afb-47bd-80c2-98652551d293]]></Field>
	<Field name="IndChange" type="java.lang.String"><![CDATA[U]]></Field>
	<Field name="IndPromptParam" type="java.lang.String">null</Field>
	<Field name="IntVersion" type="com.sunopsis.sql.DbInt"><![CDATA[6]]></Field>
	<Field name="IsMaterialized" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IDeploySpec" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IMapping" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IPackage" type="com.sunopsis.sql.DbInt"><![CDATA[9271]]></Field>
	<Field name="IPop" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScenFolder" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtScen" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2022-06-06 20:14:48.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[TST_MPEROTA]]></Field>
	<Field name="MaxCecSess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="RepGuid" type="java.lang.String">null</Field>
	<Field name="RepVersion" type="java.lang.String">null</Field>
	<Field name="RestartType" type="java.lang.String">null</Field>
	<Field name="ScenName" type="java.lang.String"><![CDATA[PKG_BDL_ES_2_FT_ALL_APPOINTMENTS]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenSnapshotNo" type="com.sunopsis.sql.DbInt"><![CDATA[18]]></Field>
	<Field name="ScenVersion" type="java.lang.String"><![CDATA[001]]></Field>
	<Field name="VLastDate" type="java.sql.Timestamp">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[567bf4d0-926c-42ef-8743-bdebe7956fb8]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[35149762]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[35149762]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[460043]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-06-01 19:37:19.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[4754]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-06-01 20:56:33.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[Internal]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (457875) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS_02 fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS_02 fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (40)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (70)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (70)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (120)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLException: ORA-14501: object is not partitioned

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:510)
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:462)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1105)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:551)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:656)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:230)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:42)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:929)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1280)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1921)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1876)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:304)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:208)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:142)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:216)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:128)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2225)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Error : 14501, Position : 17810, Sql = 
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL 
) 
select /*+  */
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	457341 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS_02' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_2.COMPANY_CD_1 X_AUD_COMPANY_CD,
	INLINE_VIEW_2.COMPANY_CD_1 COMPANY_CD,
	INLINE_VIEW_2.DIVISION_CD_1 DIVISION_CD,
	INLINE_VIEW_2.SHOP_CD SHOP_CD,
	INLINE_VIEW_2.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_2.LAPTOP_CD LAPTOP_CD,
	INLINE_VIEW_2.COMPANY_HK COMPANY_HK,
	INLINE_VIEW_2.SHOP_HK SHOP_HK,
	INLINE_VIEW_2.CUSTOMER_HK CUSTOMER_HK,
	INLINE_VIEW_2.LOCATION_TYPE_HK LOCATION_TYPE_HK,
	INLINE_VIEW_2.CLC_STATUS_HK_1 CLC_STATUS_HK,
	INLINE_VIEW_2.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	INLINE_VIEW_2.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	INLINE_VIEW_2.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	INLINE_VIEW_2.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	INLINE_VIEW_2.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	INLINE_VIEW_2.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	INLINE_VIEW_2.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	INLINE_VIEW_2.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	INLINE_VIEW_2.EMPLOYEE_HK EMPLOYEE_HK,
	INLINE_VIEW_2.SERVICE_APPOINTMENT_HK SERVICE_APPOINTMENT_HK,
	INLINE_VIEW_2.MEDIATYPE_HK MEDIATYPE_HK,
	INLINE_VIEW_2.CAMPAIGN_HK CAMPAIGN_HK,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_SK APPOINTMENT_BOOKING_SK,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_SK APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_2.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_2.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	INLINE_VIEW_2.CAMPAING_CD CAMPAING_CD,
	INLINE_VIEW_2.MEDIATYPE_CD MEDIATYPE_CD,
	INLINE_VIEW_2.RESULT_CD RESULT_CD,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_DT APPOINTMENT_BOOKING_DT,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_2.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_2.APPOINTMENT_DT_REF APPOINTMENT_DT_REF,
	INLINE_VIEW_2.D_LAST_SALE_HOT_COLD_DT D_LAST_SALE_HOT_COLD_DT,
	INLINE_VIEW_2.D_CLC_REFERENCE_DATE_DT D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_2.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_2.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_2.INVOICING_APP_AMOUNT_QT INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_2.INVOICING_APP_UNITS INVOICING_APP_UNITS,
	INLINE_VIEW_2.M_FROM_CALL_CENTER_FL M_FROM_CALL_CENTER_FL,
	INLINE_VIEW_2.M_FROM_WEB_FL M_FROM_WEB_FL,
	INLINE_VIEW_2.M_FROM_SHOP_FL M_FROM_SHOP_FL,
	INLINE_VIEW_2.M_COMPLETED_FL M_COMPLETED_FL,
	INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL M_FUTURE_APPOINTMENT_FL,
	INLINE_VIEW_2.M_SCHEDULED_APPOINTMENT_FL M_SCHEDULED_APPOINTMENT_FL,
	INLINE_VIEW_2.M_CLIENT_ID M_CLIENT_ID,
	INLINE_VIEW_2.M458_TIME_TO_APPOINTMENT_QT M458_TIME_TO_APPOINTMENT_QT,
	INLINE_VIEW_2.M_AGENDA_APPOINTMENTS_FL M_AGENDA_APPOINTMENTS_FL,
	INLINE_VIEW_2.M_CANCELED_FL M_CANCELED_FL,
	INLINE_VIEW_2.TEST_AGEING_SK TEST_AGEING_SK,
	INLINE_VIEW_2.INTERACTION_AGEING_SK INTERACTION_AGEING_SK,
	INLINE_VIEW_2.D_CANCELLATION_DATE_DT D_CANCELLATION_DATE_DT,
	CASE
  WHEN (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END) IS NOT NULL
  THEN STANDARD_HASH(INLINE_VIEW_2.COMPANY_CD_1 || INLINE_VIEW_2.DIVISION_CD_1 || (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END)  )
  ELSE STANDARD_HASH ('-1')
END MEDICAL_MEDIATYPE_HK,
	CASE
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR IS NULL AND  INLINE_VIEW_2.SERVICE_TYPE_CODE IN ('00','02','04') THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 4 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 5 AND INLINE_VIEW_2.M_HEARING_LOSS_FL = 1 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 1 AND INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL = 1 THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 3 AND INLINE_VIEW_2.AGING_CLUSTER_CD = 2 AND  INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    ELSE 0
END M_OPPT_APP_FL 
from	(
SELECT 
  FTB_ACTIVITY_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ACTIVITY_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ACTIVITY_BASE.CUSTOMER_CD AS CUSTOMER_CD   
FROM 
  BDFL.FTB_ACTIVITY_BASE PARTITION(P_ES) FTB_ACTIVITY_BASE  
WHERE
  ((FTB_ACTIVITY_BASE.DIVISION_CD = '001' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM') 
OR (FTB_ACTIVITY_BASE.DIVISION_CD = '002' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM' AND  TRUNC(FTB_ACTIVITY_BASE.ACTIVITY_DATE_DT) >= to_date('2019-01-01','yyyy-mm-dd'))
) 
GROUP BY
  FTB_ACTIVITY_BASE.COMPANY_CD,FTB_ACTIVITY_BASE.DIVISION_CD,FTB_ACTIVITY_BASE.CUSTOMER_CD 
  ) FTB_ACTIVITY_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.AGE_CD AS AGE_CD ,
  INLINE_VIEW_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW_1.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW_1.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW_1.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW_1.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW_1.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW_1.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW_1.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW_1.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW_1.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW_1.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW_1.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW_1.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW_1.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW_1.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW_1.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW_1.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW_1.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_1.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW_1.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW_1.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW_1.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW_1.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW_1.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW_1.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW_1.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW_1.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW_1.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW_1.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW_1.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW_1.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW_1.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COMPANY_CODE AS COMPANY_CODE ,
  INLINE_VIEW_1.DIVISION_CODE AS DIVISION_CODE ,
  INLINE_VIEW_1.SERVICE_CODE AS SERVICE_CODE ,
  INLINE_VIEW_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  INLINE_VIEW_1.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_1.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  INLINE_VIEW_1.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  INLINE_VIEW_1.COL_1 AS COL_1   
FROM 
  (
SELECT 
  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW.COL AS COL ,
  UM_AG_S_SERVICE_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  FT_TEST_ACTIVITY.COMPANY_CD AS COMPANY_CD_2 ,
  FT_TEST_ACTIVITY.DIVISION_CD AS DIVISION_CD_2 ,
  FT_TEST_ACTIVITY.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  FT_TEST_ACTIVITY.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  FT_TEST_ACTIVITY.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  ROW_NUMBER() OVER (PARTITION BY 
INLINE_VIEW.COMPANY_CD,
INLINE_VIEW.DIVISION_CD,
INLINE_VIEW.SHOP_CD,
INLINE_VIEW.APPOINTMENT_ID,
INLINE_VIEW.LAPTOP_CD,
INLINE_VIEW.CUSTOMER_HK
ORDER BY FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT DESC) AS COL_1   
FROM 
  ((
SELECT 
  CF_LAST_SALE_AGING_RANGE.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE.AGING_CLUSTER_CD AS AGING_CLUSTER_CD   
FROM 
  DMM_BDL_ANL.CF_LAST_SALE_AGING_RANGE PARTITION(P_ES_PT) CF_LAST_SALE_AGING_RANGE  
WHERE
  (CF_LAST_SALE_AGING_RANGE.COMPANY_CD = '002'
) 
  ) CF_LAST_SALE_AGING_RANGE_1  RIGHT OUTER JOIN  ((
SELECT 
  UM_AG_S_SERVICE.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE   
FROM 
  EDW.UM_AG_S_SERVICE PARTITION(P_ES_PT) UM_AG_S_SERVICE  
WHERE
  (UM_AG_S_SERVICE.COMPANY_CODE = '002'
AND UM_AG_S_SERVICE.X_AUD_CURRENT_FL = 1
) 
  ) UM_AG_S_SERVICE_1  RIGHT OUTER JOIN  (
SELECT 
  DM_CLC_STATUS.CLC_STATUS_HK AS CLC_STATUS_HK ,
  DM_CLC_STATUS.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  DM_CLC_STATUS.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_CD AS COMPANY_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.DIVISION_CD AS DIVISION_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_CD AS SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.LAPTOP_CD AS LAPTOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_HK AS COMPANY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_HK AS SHOP_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CUSTOMER_HK AS CUSTOMER_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK AS CLC_STATUS_HK_1 ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.EMPLOYEE_HK AS EMPLOYEE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_HK AS MEDIATYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAIGN_HK AS CAMPAIGN_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAING_CD AS CAMPAING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_CD AS MEDIATYPE_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.RESULT_CD AS RESULT_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_COMPLETED_FL AS M_COMPLETED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CLIENT_ID AS M_CLIENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CANCELED_FL AS M_CANCELED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.TEST_AGEING_SK AS TEST_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT - FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS COL   
FROM 
  DMM_BDL_ANL.DM_CLC_STATUS DM_CLC_STATUS  RIGHT OUTER JOIN  STG_BDFL_ES.FT_ALL_APPOINTMENTS_TT_ES FT_ALL_APPOINTMENTS_TT_ES  
    ON  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK = DM_CLC_STATUS.CLC_STATUS_HK
  ) INLINE_VIEW  
    ON  STANDARD_HASH(UM_AG_S_SERVICE_1.COMPANY_CODE||UM_AG_S_SERVICE_1.DIVISION_CODE||UM_AG_S_SERVICE_1.SERVICE_CODE) = INLINE_VIEW.SERVICE_APPOINTMENT_HK
     )  
    ON  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND CF_LAST_SALE_AGING_RANGE_1.AGE_CD = INLINE_VIEW.COL
     )  LEFT OUTER JOIN  DMM_BDL_ANL.FT_TEST_ACTIVITY PARTITION(P_ES) FT_TEST_ACTIVITY  
    ON  FT_TEST_ACTIVITY.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND FT_TEST_ACTIVITY.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND FT_TEST_ACTIVITY.CUSTOMER_HK = INLINE_VIEW.CUSTOMER_HK
AND FT_TEST_ACTIVITY.ACTIVITY_DATE_DT < INLINE_VIEW.APPOINTMENT_SCHEDULING_DT
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_1 = 1
) 
  ) INLINE_VIEW_2  
    ON  FTB_ACTIVITY_BASE_1.COMPANY_CD =   INLINE_VIEW_2.COMPANY_CD_1
AND FTB_ACTIVITY_BASE_1.DIVISION_CD = INLINE_VIEW_2.DIVISION_CD_1
AND  STANDARD_HASH(FTB_ACTIVITY_BASE_1.COMPANY_CD || FTB_ACTIVITY_BASE_1.DIVISION_CD || FTB_ACTIVITY_BASE_1.CUSTOMER_CD ) = INLINE_VIEW_2.CUSTOMER_HK
where		(1=1)	
)  ODI_GET_FROM
   , OriginalSql =  
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL 
) 
select /*+  */
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	457341 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS_02' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_2.COMPANY_CD_1 X_AUD_COMPANY_CD,
	INLINE_VIEW_2.COMPANY_CD_1 COMPANY_CD,
	INLINE_VIEW_2.DIVISION_CD_1 DIVISION_CD,
	INLINE_VIEW_2.SHOP_CD SHOP_CD,
	INLINE_VIEW_2.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_2.LAPTOP_CD LAPTOP_CD,
	INLINE_VIEW_2.COMPANY_HK COMPANY_HK,
	INLINE_VIEW_2.SHOP_HK SHOP_HK,
	INLINE_VIEW_2.CUSTOMER_HK CUSTOMER_HK,
	INLINE_VIEW_2.LOCATION_TYPE_HK LOCATION_TYPE_HK,
	INLINE_VIEW_2.CLC_STATUS_HK_1 CLC_STATUS_HK,
	INLINE_VIEW_2.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	INLINE_VIEW_2.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	INLINE_VIEW_2.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	INLINE_VIEW_2.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	INLINE_VIEW_2.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	INLINE_VIEW_2.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	INLINE_VIEW_2.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	INLINE_VIEW_2.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	INLINE_VIEW_2.EMPLOYEE_HK EMPLOYEE_HK,
	INLINE_VIEW_2.SERVICE_APPOINTMENT_HK SERVICE_APPOINTMENT_HK,
	INLINE_VIEW_2.MEDIATYPE_HK MEDIATYPE_HK,
	INLINE_VIEW_2.CAMPAIGN_HK CAMPAIGN_HK,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_SK APPOINTMENT_BOOKING_SK,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_SK APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_2.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_2.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	INLINE_VIEW_2.CAMPAING_CD CAMPAING_CD,
	INLINE_VIEW_2.MEDIATYPE_CD MEDIATYPE_CD,
	INLINE_VIEW_2.RESULT_CD RESULT_CD,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_DT APPOINTMENT_BOOKING_DT,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_2.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_2.APPOINTMENT_DT_REF APPOINTMENT_DT_REF,
	INLINE_VIEW_2.D_LAST_SALE_HOT_COLD_DT D_LAST_SALE_HOT_COLD_DT,
	INLINE_VIEW_2.D_CLC_REFERENCE_DATE_DT D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_2.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_2.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_2.INVOICING_APP_AMOUNT_QT INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_2.INVOICING_APP_UNITS INVOICING_APP_UNITS,
	INLINE_VIEW_2.M_FROM_CALL_CENTER_FL M_FROM_CALL_CENTER_FL,
	INLINE_VIEW_2.M_FROM_WEB_FL M_FROM_WEB_FL,
	INLINE_VIEW_2.M_FROM_SHOP_FL M_FROM_SHOP_FL,
	INLINE_VIEW_2.M_COMPLETED_FL M_COMPLETED_FL,
	INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL M_FUTURE_APPOINTMENT_FL,
	INLINE_VIEW_2.M_SCHEDULED_APPOINTMENT_FL M_SCHEDULED_APPOINTMENT_FL,
	INLINE_VIEW_2.M_CLIENT_ID M_CLIENT_ID,
	INLINE_VIEW_2.M458_TIME_TO_APPOINTMENT_QT M458_TIME_TO_APPOINTMENT_QT,
	INLINE_VIEW_2.M_AGENDA_APPOINTMENTS_FL M_AGENDA_APPOINTMENTS_FL,
	INLINE_VIEW_2.M_CANCELED_FL M_CANCELED_FL,
	INLINE_VIEW_2.TEST_AGEING_SK TEST_AGEING_SK,
	INLINE_VIEW_2.INTERACTION_AGEING_SK INTERACTION_AGEING_SK,
	INLINE_VIEW_2.D_CANCELLATION_DATE_DT D_CANCELLATION_DATE_DT,
	CASE
  WHEN (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END) IS NOT NULL
  THEN STANDARD_HASH(INLINE_VIEW_2.COMPANY_CD_1 || INLINE_VIEW_2.DIVISION_CD_1 || (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END)  )
  ELSE STANDARD_HASH ('-1')
END MEDICAL_MEDIATYPE_HK,
	CASE
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR IS NULL AND  INLINE_VIEW_2.SERVICE_TYPE_CODE IN ('00','02','04') THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 4 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 5 AND INLINE_VIEW_2.M_HEARING_LOSS_FL = 1 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 1 AND INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL = 1 THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 3 AND INLINE_VIEW_2.AGING_CLUSTER_CD = 2 AND  INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    ELSE 0
END M_OPPT_APP_FL 
from	(
SELECT 
  FTB_ACTIVITY_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ACTIVITY_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ACTIVITY_BASE.CUSTOMER_CD AS CUSTOMER_CD   
FROM 
  BDFL.FTB_ACTIVITY_BASE PARTITION(P_ES) FTB_ACTIVITY_BASE  
WHERE
  ((FTB_ACTIVITY_BASE.DIVISION_CD = '001' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM') 
OR (FTB_ACTIVITY_BASE.DIVISION_CD = '002' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM' AND  TRUNC(FTB_ACTIVITY_BASE.ACTIVITY_DATE_DT) >= to_date('2019-01-01','yyyy-mm-dd'))
) 
GROUP BY
  FTB_ACTIVITY_BASE.COMPANY_CD,FTB_ACTIVITY_BASE.DIVISION_CD,FTB_ACTIVITY_BASE.CUSTOMER_CD 
  ) FTB_ACTIVITY_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.AGE_CD AS AGE_CD ,
  INLINE_VIEW_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW_1.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW_1.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW_1.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW_1.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW_1.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW_1.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW_1.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW_1.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW_1.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW_1.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW_1.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW_1.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW_1.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW_1.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW_1.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW_1.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW_1.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_1.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW_1.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW_1.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW_1.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW_1.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW_1.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW_1.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW_1.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW_1.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW_1.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW_1.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW_1.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW_1.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW_1.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COMPANY_CODE AS COMPANY_CODE ,
  INLINE_VIEW_1.DIVISION_CODE AS DIVISION_CODE ,
  INLINE_VIEW_1.SERVICE_CODE AS SERVICE_CODE ,
  INLINE_VIEW_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  INLINE_VIEW_1.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_1.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  INLINE_VIEW_1.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  INLINE_VIEW_1.COL_1 AS COL_1   
FROM 
  (
SELECT 
  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW.COL AS COL ,
  UM_AG_S_SERVICE_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  FT_TEST_ACTIVITY.COMPANY_CD AS COMPANY_CD_2 ,
  FT_TEST_ACTIVITY.DIVISION_CD AS DIVISION_CD_2 ,
  FT_TEST_ACTIVITY.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  FT_TEST_ACTIVITY.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  FT_TEST_ACTIVITY.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  ROW_NUMBER() OVER (PARTITION BY 
INLINE_VIEW.COMPANY_CD,
INLINE_VIEW.DIVISION_CD,
INLINE_VIEW.SHOP_CD,
INLINE_VIEW.APPOINTMENT_ID,
INLINE_VIEW.LAPTOP_CD,
INLINE_VIEW.CUSTOMER_HK
ORDER BY FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT DESC) AS COL_1   
FROM 
  ((
SELECT 
  CF_LAST_SALE_AGING_RANGE.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE.AGING_CLUSTER_CD AS AGING_CLUSTER_CD   
FROM 
  DMM_BDL_ANL.CF_LAST_SALE_AGING_RANGE PARTITION(P_ES_PT) CF_LAST_SALE_AGING_RANGE  
WHERE
  (CF_LAST_SALE_AGING_RANGE.COMPANY_CD = '002'
) 
  ) CF_LAST_SALE_AGING_RANGE_1  RIGHT OUTER JOIN  ((
SELECT 
  UM_AG_S_SERVICE.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE   
FROM 
  EDW.UM_AG_S_SERVICE PARTITION(P_ES_PT) UM_AG_S_SERVICE  
WHERE
  (UM_AG_S_SERVICE.COMPANY_CODE = '002'
AND UM_AG_S_SERVICE.X_AUD_CURRENT_FL = 1
) 
  ) UM_AG_S_SERVICE_1  RIGHT OUTER JOIN  (
SELECT 
  DM_CLC_STATUS.CLC_STATUS_HK AS CLC_STATUS_HK ,
  DM_CLC_STATUS.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  DM_CLC_STATUS.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_CD AS COMPANY_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.DIVISION_CD AS DIVISION_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_CD AS SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.LAPTOP_CD AS LAPTOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_HK AS COMPANY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_HK AS SHOP_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CUSTOMER_HK AS CUSTOMER_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK AS CLC_STATUS_HK_1 ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.EMPLOYEE_HK AS EMPLOYEE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_HK AS MEDIATYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAIGN_HK AS CAMPAIGN_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAING_CD AS CAMPAING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_CD AS MEDIATYPE_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.RESULT_CD AS RESULT_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_COMPLETED_FL AS M_COMPLETED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CLIENT_ID AS M_CLIENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CANCELED_FL AS M_CANCELED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.TEST_AGEING_SK AS TEST_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT - FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS COL   
FROM 
  DMM_BDL_ANL.DM_CLC_STATUS DM_CLC_STATUS  RIGHT OUTER JOIN  STG_BDFL_ES.FT_ALL_APPOINTMENTS_TT_ES FT_ALL_APPOINTMENTS_TT_ES  
    ON  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK = DM_CLC_STATUS.CLC_STATUS_HK
  ) INLINE_VIEW  
    ON  STANDARD_HASH(UM_AG_S_SERVICE_1.COMPANY_CODE||UM_AG_S_SERVICE_1.DIVISION_CODE||UM_AG_S_SERVICE_1.SERVICE_CODE) = INLINE_VIEW.SERVICE_APPOINTMENT_HK
     )  
    ON  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND CF_LAST_SALE_AGING_RANGE_1.AGE_CD = INLINE_VIEW.COL
     )  LEFT OUTER JOIN  DMM_BDL_ANL.FT_TEST_ACTIVITY PARTITION(P_ES) FT_TEST_ACTIVITY  
    ON  FT_TEST_ACTIVITY.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND FT_TEST_ACTIVITY.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND FT_TEST_ACTIVITY.CUSTOMER_HK = INLINE_VIEW.CUSTOMER_HK
AND FT_TEST_ACTIVITY.ACTIVITY_DATE_DT < INLINE_VIEW.APPOINTMENT_SCHEDULING_DT
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_1 = 1
) 
  ) INLINE_VIEW_2  
    ON  FTB_ACTIVITY_BASE_1.COMPANY_CD =   INLINE_VIEW_2.COMPANY_CD_1
AND FTB_ACTIVITY_BASE_1.DIVISION_CD = INLINE_VIEW_2.DIVISION_CD_1
AND  STANDARD_HASH(FTB_ACTIVITY_BASE_1.COMPANY_CD || FTB_ACTIVITY_BASE_1.DIVISION_CD || FTB_ACTIVITY_BASE_1.CUSTOMER_CD ) = INLINE_VIEW_2.CUSTOMER_HK
where		(1=1)	
)  ODI_GET_FROM
   , Error Msg = ORA-14501: object is not partitioned

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:514)
	... 30 more
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[8d08778d-44d5-4eb6-a67c-02251a31164d]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[17168501]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[17168501]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[457875]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-23 19:20:57.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2841]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-23 20:08:18.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[09a65edc-ac9f-4cb8-a39e-d7b25d36ae76]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[458320]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-25 11:38:09.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3808]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-25 12:41:37.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[360eed33-bad3-4813-b9eb-2df1f798f5c7]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[459009]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-27 14:29:29.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[4040]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-27 15:36:49.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[31f04471-e00b-4dc9-9eeb-ab19dc065346]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[83573471]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[83573471]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[446858]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-03-16 07:32:27.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2909]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-03-16 08:20:56.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[edf94d54-a56a-4ea5-9ecf-4ea4059999ec]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[233403]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-01 08:27:40.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3320]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-01 09:23:00.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[a4d69eab-ee8e-417a-acac-b51e38af7669]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[83573471]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[83573471]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[443448]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-02-25 14:37:09.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2973]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-02-25 15:26:42.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1256: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (449617) stopped (Normal) by user TST_JHOXHA.
ODI-1263: Step MAP_ES_FT_ALL_APPOINTMENTS stopped (Normal) by user TST_JHOXHA.
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1259: Session Task SERIAL-MAP_MAIN- stopped (Normal) by user TST_JHOXHA.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (50)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" is in error.
ODI-1259: Session Task SERIAL-EU-LOG_BDFL_DMM_UNIT_1 stopped (Normal) by user TST_JHOXHA.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (170)" is in error.
ODI-1259: Session Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- stopped (Normal) by user TST_JHOXHA.
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.getStopTaskAgentException(AbstractSessionTask.java:1193)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.postProcess(AbstractSessionTask.java:1234)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:913)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[92ff86f1-78d2-4729-a06a-dcf94f155f8b]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[449617]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-04-04 10:09:35.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2126]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-04-04 10:45:01.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235063) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (70)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (140)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (140)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (200)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:510)
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:462)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1105)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:551)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:656)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:230)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:42)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:929)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1280)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1921)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1876)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:304)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:208)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:142)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:217)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:129)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Error : 911, Position : 13427, Sql = 
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  STG_BDFL_ES.UM_CU_B_ACTIVITY_ES_TT UM_CU_B_ACTIVITY_ES_TT  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER DESC
) = 1)
)  ODI_GET_FROM
  , OriginalSql =  
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  STG_BDFL_ES.UM_CU_B_ACTIVITY_ES_TT UM_CU_B_ACTIVITY_ES_TT  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER DESC
) = 1)
)  ODI_GET_FROM
  , Error Msg = ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:514)
	... 36 more
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[b84fb52c-9b84-4bdd-87d4-8720c9235b55]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235063]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-09 09:30:58.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[190]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-09 09:34:08.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235672) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Append TMP for Amplifon- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (50)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" failed because child task "Insert new rows-IKM Oracle Append TMP for Amplifon- (120)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Append TMP for Amplifon- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLRecoverableException: Closed Connection
	at oracle.jdbc.driver.PhysicalConnection.getAutoCommit(PhysicalConnection.java:2398)
	at sun.reflect.GeneratedMethodAccessor109.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at oracle.odi.core.datasource.dwgobject.support.OnConnectOnDisconnectDataSourceAdapter$OnDisconnectCommandExecutionHandler.invoke(OnConnectOnDisconnectDataSourceAdapter.java:231)
	at com.sun.proxy.$Proxy79.getAutoCommit(Unknown Source)
	at com.sunopsis.sql.SnpsConnection.createConnection(SnpsConnection.java:683)
	at com.sunopsis.sql.SnpsConnection.connect(SnpsConnection.java:629)
	at oracle.odi.runtime.agent.execution.SessionTask.getExecutor(SessionTask.java:271)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:177)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:129)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[7e018e87-fabf-4190-9797-7d9d25d28586]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235672]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-13 11:25:29.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[0]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-13 11:25:29.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fb45b24b-2df9-432b-b30d-1a448c105262]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235685]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-13 11:26:21.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3133]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-13 12:18:34.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1256: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235916) stopped (Normal) by user TST_GMURFONE.
ODI-1263: Step MAP_ES_FT_ALL_APPOINTMENTS stopped (Normal) by user TST_GMURFONE.
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Append TMP for Amplifon- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1259: Session Task SERIAL-MAP_MAIN- stopped (Normal) by user TST_GMURFONE.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (50)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" is in error.
ODI-1259: Session Task SERIAL-EU-LOG_BDFL_DMM_UNIT_1 stopped (Normal) by user TST_GMURFONE.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (90)" failed because child task "Insert new rows-IKM Oracle Append TMP for Amplifon- (120)" is in error.
ODI-1259: Session Task Insert new rows-IKM Oracle Append TMP for Amplifon- stopped (Normal) by user TST_GMURFONE.
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.getStopTaskAgentException(AbstractSessionTask.java:1193)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.postProcess(AbstractSessionTask.java:1234)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:913)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[bc187506-f295-4892-ae23-8bb64f681537]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235916]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-13 22:18:41.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[116]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-13 22:20:37.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[534c0f65-4706-46e8-b1a4-650a5f7fc7b0]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235969]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-14 08:37:21.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2861]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-14 09:25:02.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[7a614a53-877d-4353-be50-489ac9ca2966]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[70192398]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[70192398]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[243745]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-10-01 19:13:01.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1321]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-10-01 19:35:02.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d5c39283-6851-47f2-8907-f51633fa13ec]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[234557]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-07 10:27:18.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3749]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-07 11:29:47.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235077) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (70)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (140)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (140)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (220)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:510)
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:462)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1105)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:551)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:656)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:230)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:42)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:929)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1280)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1921)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1876)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:304)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:208)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:142)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:217)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:129)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Error : 911, Position : 13427, Sql = 
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  STG_BDFL_ES.UM_CU_B_ACTIVITY_ES_TT UM_CU_B_ACTIVITY_ES_TT  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER DESC
) = 1)
)  ODI_GET_FROM
  , OriginalSql =  
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE||UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE||UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY_ES_TT.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY_ES_TT.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  STG_BDFL_ES.UM_CU_B_ACTIVITY_ES_TT UM_CU_B_ACTIVITY_ES_TT  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY_ES_TT.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY_ES_TT.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY_ES_TT.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY_ES_TT.REFERENCE_NUMBER DESC
) = 1)
)  ODI_GET_FROM
  , Error Msg = ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:514)
	... 36 more
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[9b654990-9b83-4a4f-8aa7-8fd279d3f86b]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235077]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-09 09:51:49.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[235]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-09 09:55:44.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[dd7b7149-a3e2-4593-baf8-6010e286b036]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[233536]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-01 20:14:57.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3090]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-01 21:06:27.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fa5e7f74-1f84-4aa5-9a82-da0bbf55a1aa]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[234274]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-06 16:17:53.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2875]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-06 17:05:48.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[085a8903-5b57-43b2-9e64-a48dfb1bc2b5]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[14835229]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[233240]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-06-30 15:10:10.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2739]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-06-30 15:55:49.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235060) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (60)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (110)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (110)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (160)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:510)
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:462)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1105)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:551)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:656)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:230)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:42)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:929)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1280)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1921)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1876)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:304)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:208)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:142)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:217)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:129)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Error : 911, Position : 13367, Sql = 
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  EDW.UM_CU_B_ACTIVITY PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_B_ACTIVITY  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY.REFERENCE_NUMBER DESC
)=1)
)  ODI_GET_FROM
  , OriginalSql =  
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  EDW.UM_CU_B_ACTIVITY PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_B_ACTIVITY  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY.REFERENCE_NUMBER DESC
)=1)
)  ODI_GET_FROM
  , Error Msg = ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:514)
	... 36 more
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[26d327f9-b1d9-410d-8e08-d99aa42060e3]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235060]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-09 08:39:36.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-09 08:39:37.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[34498d27-2f6a-4391-ab31-1b36bf84578c]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34273140]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34273140]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[453193]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-02 10:07:06.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2575]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-02 10:50:01.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session PKG_BDL_ES_2_FT_ALL_APPOINTMENTS (235061) fails with return code ODI-1298.
ODI-1226: Step MAP_ES_FT_ALL_APPOINTMENTS fails after 1 attempt(s).
ODI-1240: Flow MAP_ES_FT_ALL_APPOINTMENTS fails while performing a Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- operation. This flow loads target table FT_ALL_APPOINTMENTS.
ODI-1298: Serial task "SERIAL-MAP_MAIN- (60)" failed because child task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (110)" is in error.
ODI-1298: Serial task "SERIAL-EU-LOG_BDFL_DMM_UNIT_1 (110)" failed because child task "Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- (160)" is in error.
ODI-1228: Task Insert new rows-IKM Oracle Control Append for BDFL (multi-partition)- fails on the target connection PHY_BDFL_DMM_ES.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:510)
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:462)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1105)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:551)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:656)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:230)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:42)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:929)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1280)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1921)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1876)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:304)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:208)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:142)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:217)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:129)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2224)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:610)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Error : 911, Position : 13367, Sql = 
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  EDW.UM_CU_B_ACTIVITY PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_B_ACTIVITY  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY.REFERENCE_NUMBER DESC
)=1)
)  ODI_GET_FROM
  , OriginalSql =  
insert /*+ APPEND */ into	DMM_BDL_ANL.FT_ALL_APPOINTMENTS
 PARTITION(P_ES)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK 
) 
select
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	231589 X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS' || ' (' || 'CTX_ES' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_7.COMPANY_CD X_AUD_COMPANY_CD,
	INLINE_VIEW_7.COMPANY_CD COMPANY_CD,
	INLINE_VIEW_7.DIVISION_CD DIVISION_CD,
	INLINE_VIEW_7.SHOP_CD SHOP_CD,
	INLINE_VIEW_7.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_7.LAPTOP_CD LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.TRG_DIVISION_CD) COMPANY_HK,
	CASE WHEN
INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END SHOP_HK,
	INLINE_VIEW_7.CUSTOMER_HK_1 CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_7.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END LOCATION_TYPE_HK,
	NVL(FT_CUSTOMER_BASE.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C') CLC_STATUS_HK,
	FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	FT_CUSTOMER_BASE.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	FT_CUSTOMER_BASE.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	FT_CUSTOMER_BASE.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_7.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_7.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.EMPLOYEE_CD||INLINE_VIEW_7.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END EMPLOYEE_HK,
	CASE WHEN 
INLINE_VIEW_7.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_7.COMPANY_CD||INLINE_VIEW_7.DIVISION_CD||INLINE_VIEW_7.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END SERVICE_APPOINTMENT_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END MEDIATYPE_HK,
	CASE WHEN
UM_CU_B_ACTIVITY.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(UM_CU_B_ACTIVITY.COMPANY_CODE||UM_CU_B_ACTIVITY.DIVISION_CODE||UM_CU_B_ACTIVITY.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END CAMPAIGN_HK,
	TO_CHAR(TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT), 'YYYYMMDD') APPOINTMENT_BOOKING_SK,
	TO_CHAR(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD') APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_7.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_7.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	UM_CU_B_ACTIVITY.CAMPAIGN_CODE CAMPAING_CD,
	UM_CU_B_ACTIVITY.MEDIATYPE_CODE MEDIATYPE_CD,
	INLINE_VIEW_7.RESULT_CD RESULT_CD,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) APPOINTMENT_BOOKING_DT,
	TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT) APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_7.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_7.COL_8 APPOINTMENT_DT_REF,
	FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT D_LAST_SALE_HOT_COLD_DT,
	CASE WHEN INLINE_VIEW_7.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_7.CREATION_DATE_DT) - 30
END D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_7.REASON_CLOSING_CD REASON_CLOSING_CD,
	INLINE_VIEW_7.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_7.COL_4 INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_7.COL_5 INVOICING_APP_UNITS,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END M_FROM_CALL_CENTER_FL,
	0 M_FROM_WEB_FL,
	CASE INLINE_VIEW_7.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_7.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_7.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END M_FROM_SHOP_FL,
	CASE 
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END M_COMPLETED_FL,
	CASE WHEN INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END M_FUTURE_APPOINTMENT_FL,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END M_SCHEDULED_APPOINTMENT_FL,
	CASE 
  WHEN INLINE_VIEW_7.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_7.MASTER_COMPANY_CD||INLINE_VIEW_7.MASTER_DIVISION_CD||INLINE_VIEW_7.MASTER_CUSTOMER_CD
  ELSE NULL
END M_CLIENT_ID,
	TRUNC( INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_7.APPOINTMENT_BOOKING_DT) M458_TIME_TO_APPOINTMENT_QT,
	CASE
  WHEN INLINE_VIEW_7.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_7.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_7.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END M_CANCELED_FL,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.TST_LAST_TEST_DT)
    ELSE 3651
END TEST_AGEING_SK,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_7.COL_7) - TRUNC(FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT)
    ELSE 3651
END INTERACTION_AGEING_SK 
from	((
SELECT 
  INLINE_VIEW_5.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_5.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_5.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_5.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_5.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_5.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_5.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_5.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_5.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_5.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_5.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_5.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_5.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_5.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_5.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_5.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_5.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_5.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_5.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_5.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_5.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_5.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_5.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_5.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_5.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_5.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_5.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_5.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_5.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_5.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_5.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_5.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_5.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_5.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_5.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_5.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_5.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_5.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_5.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_5.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_5.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_5.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_5.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_5.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_5.COL AS COL ,
  INLINE_VIEW_5.COL_1 AS COL_1 ,
  INLINE_VIEW_5.COL_2 AS COL_2 ,
  INLINE_VIEW_5.COL_3 AS COL_3 ,
  INLINE_VIEW_5.COL_4 AS COL_4 ,
  INLINE_VIEW_5.COL_5 AS COL_5 ,
  INLINE_VIEW_5.COL_6 AS COL_6 ,
  INLINE_VIEW_6.CUSTOMER_HK AS CUSTOMER_HK_2 ,
  INLINE_VIEW_6.STATUS_FROM_DT AS STATUS_FROM_DT_1 ,
  INLINE_VIEW_6.STATUS_TO_DT AS STATUS_TO_DT_1 ,
  CASE WHEN INLINE_VIEW_5.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_5.COL_3 = 1 AND INLINE_VIEW_5.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 30
                    END
               ELSE TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1
          END
     ELSE NULL
END AS COL_7 ,
  LAG(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT) 
OVER (PARTITION BY  INLINE_VIEW_5.COMPANY_CD,
                    INLINE_VIEW_5.CUSTOMER_CD,  
                    INLINE_VIEW_5.INVOICING_APP_FL
          ORDER BY  INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT,
                    INLINE_VIEW_5.APPOINTMENT_ID
      ) AS COL_8   
FROM 
  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_6  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_3.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_3.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_4 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_6   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_1 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_2 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_3   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  BDFL.FTB_TRIAL_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  BDFL.FTB_ALL_APPOINTMENTS_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  DMM_BDL_ANL.CF_SHOP_REMAPPING CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD = FTB_TRIAL_BASE_1.COMPANY_CD AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT, FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT, ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12))
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_2 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_6 = 1
) 
  ) INLINE_VIEW_4  LEFT OUTER JOIN  (
SELECT 
  (STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA.CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD)))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA.STATUS_TO_DT AS STATUS_TO_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  EDW.CL_LIGHT_CUSTOMER_STATUS PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) CL_LIGHT_CUSTOMER_STATUS_RMA_1  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.CUSTOMER_CODE AS CUSTOMER_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  EDW.UM_CU_S_CUSTOMER_MAPPING PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMA_1.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMA_1.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA.MASTER_CUSTOMER_CODE
  ) INLINE_VIEW_3  
    ON  INLINE_VIEW_4.COL_1              = INLINE_VIEW_3.CUSTOMER_HK AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 >= INLINE_VIEW_3.STATUS_FROM_DT AND
INLINE_VIEW_4.CREATION_DATE_DT - 1 < NVL(INLINE_VIEW_3.STATUS_TO_DT, TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_5  
    ON  INLINE_VIEW_5.CUSTOMER_HK_1                        = INLINE_VIEW_6.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 >= INLINE_VIEW_6.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT) - 1 < NVL(TRUNC(INLINE_VIEW_6.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_7  LEFT OUTER JOIN  DMM_BDL_ANL.FT_CUSTOMER_BASE PARTITION(#V_CONTEXT_PARTITION_CODE_TARGET) FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_7.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_7.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_7.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_7.COL_7 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_7.COL_7 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  EDW.UM_CU_B_ACTIVITY PARTITION(#V_CONTEXT_PARTITION_CODE) UM_CU_B_ACTIVITY  
    ON  INLINE_VIEW_7.COMPANY_CD=UM_CU_B_ACTIVITY.COMPANY_CODE
AND
INLINE_VIEW_7.DIVISION_CD=UM_CU_B_ACTIVITY.DIVISION_CODE
AND
INLINE_VIEW_7.APPOINTMENT_ID=UM_CU_B_ACTIVITY.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_7.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE)
where		(1=1)	
 and (ROW_NUMBER() OVER(PARTITION by FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD,
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD,
FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID,
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD,
FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD
ORDER BY TRUNC(UM_CU_B_ACTIVITY.REFERENCE_DATE DESC,
UM_CU_B_ACTIVITY.REFERENCE_NUMBER DESC
)=1)
)  ODI_GET_FROM
  , Error Msg = ORA-00911: invalid character

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:514)
	... 36 more
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cf1cdb8e-f786-4727-a4fc-93cf5c3b993a]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235061]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-09 08:40:43.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-09 08:40:44.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[ODI-1298]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[83ce77e2-2f90-4c25-bc72-2bcddc35ac92]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[68883880]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[235223]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-07-12 12:04:57.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2752]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-07-12 12:50:49.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cba0f72e-e572-4b7c-bd85-1d938b1d9e70]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[70192398]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[70192398]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[243819]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2021-10-04 11:22:41.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1355]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2021-10-04 11:45:16.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[Internal]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[3173b115-17f6-4dd8-811a-dba52318e7b5]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34328812]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34328812]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[457047]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-18 18:03:14.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3731]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-18 19:05:25.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[667a484c-374b-491b-bc5e-52f1c8adc6fd]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34337002]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34337002]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[457537]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-22 22:27:22.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[10680]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-23 01:25:22.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[bf0c2c3d-c4ef-4ad6-a557-68e112132fe6]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[459177]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-27 18:24:02.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[3402]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-27 19:20:44.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[ff737170-5858-4171-b2f1-404f689999c9]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34273140]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34273140]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[453252]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-02 15:41:21.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2395]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-02 16:21:16.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[6f9fca29-7a33-4cad-acbd-8ce3506fd72a]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[34337338]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[459256]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-05-30 11:36:49.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[4230]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-05-30 12:47:19.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent_Tst_01]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[CTX_ES]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1c629515-d276-42f7-a555-b0bd7523c3f8]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[35149832]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[35149832]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[460262]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-06-06 15:46:05.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[5872]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-06-06 17:23:57.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[299d7044-2633-40d6-973f-db31751452cf]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_MAX_TS]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[3c0106a9-1218-4323-9a4e-9a01340200a9]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[N]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_APPOINTMENT_LESS_DAYS]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d5723070-badc-4d88-a31b-90a5b1d6f99b]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_MIN_TS]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[aeb48cd2-75e2-4f55-8d3e-fb28b0af1b7d]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[N]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_NO]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String"><![CDATA[01/01/1900 00:00:00]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d3c8cf6d-bc24-45e5-91a1-b96885bdeff0]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[65164]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_TS]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[6]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpExpTxtHeader">
		<Field name="GlobalId" type="java.lang.String"><![CDATA[73cda650-902a-4b52-bbb9-2af04e044949]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[65164]]></Field>
	<Field name="Txt" type="java.lang.String"><![CDATA[Timestamp of the start of an ODI session
Set to '01/01/1900 00:00:00' for the initial data load]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f256bd65-641f-4b97-a3ec-48996c3d07f6]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[7]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[92e4bc8d-d959-4c9c-8aba-878527d5bbed]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_CONTEXT_PARTITION_CODE]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[ed7dd7a3-344f-4493-846b-60588f484838]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[L]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[N]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_TRIAL_LESS_DAYS]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[8]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[2bad9d93-0c64-422d-afc2-806099de2405]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String">null</Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="ResName" type="java.lang.String">null</Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[V_SESSION_NO]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[VD]]></Field>
	<Field name="TableName" type="java.lang.String">null</Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_NO]]></Field>
	<Field name="VarOp" type="java.lang.String"><![CDATA[=]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[a7bc5540-3297-4587-bab4-bf946087f4ad]]></Field>
	<Field name="IndErr" type="java.lang.String">null</Field>
	<Field name="IndLogFinalCmd" type="java.lang.String">null</Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Variable]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[V_SESSION_NO]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[V]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[81a87c7f-e9d8-4ea5-b793-af3a0357b765]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String">null</Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="ResName" type="java.lang.String">null</Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[V_SESSION_TS]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[VD]]></Field>
	<Field name="TableName" type="java.lang.String">null</Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_TS]]></Field>
	<Field name="VarOp" type="java.lang.String"><![CDATA[=]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[83dfbddc-e11a-4cfd-bc61-79f750e3cdd3]]></Field>
	<Field name="IndErr" type="java.lang.String">null</Field>
	<Field name="IndLogFinalCmd" type="java.lang.String">null</Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Variable]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[V_SESSION_TS]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[V]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[0a617d0a-15fd-42c4-ac99-a931e9de33c3]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String">null</Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="ResName" type="java.lang.String">null</Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[V_SESSION_MIN_TS]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[VD]]></Field>
	<Field name="TableName" type="java.lang.String">null</Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_MIN_TS]]></Field>
	<Field name="VarOp" type="java.lang.String"><![CDATA[=]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[6780ae87-f3a2-4462-ab46-dedf9fd57e56]]></Field>
	<Field name="IndErr" type="java.lang.String">null</Field>
	<Field name="IndLogFinalCmd" type="java.lang.String">null</Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Variable]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[V_SESSION_MIN_TS]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[V]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[c8d08bad-f57a-436d-aa8c-ac9e7d968fb1]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String">null</Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="ResName" type="java.lang.String">null</Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[V_SESSION_MAX_TS]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[VD]]></Field>
	<Field name="TableName" type="java.lang.String">null</Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[BDFL_AMP.V_SESSION_MAX_TS]]></Field>
	<Field name="VarOp" type="java.lang.String"><![CDATA[=]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[a224008f-61fc-40a6-9ac1-1f3e0451dc9f]]></Field>
	<Field name="IndErr" type="java.lang.String">null</Field>
	<Field name="IndLogFinalCmd" type="java.lang.String">null</Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Variable]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[V_SESSION_MAX_TS]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[V]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String"><![CDATA[<map-generation-info>
   <node name="FILTER1_AP" type="LKM" km="LKM Oracle to Oracle Pull (DB Link).GLOBAL">
      <option name="SELECT_FROM_SOURCE_VIEW" value="false" default="true"/>
      <option name="USE_STAGE_TABLE" value="false" default="true"/>
      <option name="ADD_DRIVING_SITE_HINT" value="false" default="true"/>
      <option name="CREATE_DB_LINK" value="true" default="true"/>
      <option name="SOURCE_ACCESS_DB_LINK" value="" default="true"/>
   </node>
   <node name="UM_CU_B_ACTIVITY" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FT_ALL_APPOINTMENTS_TT_ES" type="IKM" km="IKM Oracle Append TMP for Amplifon.BDFL_AMP">
      <option name="TMP_TABLE_OPTIONS" value="NOLOGGING" default="true"/>
      <option name="COMPATIBLE" value="9" default="true"/>
      <option name="ANALYZE_TARGET" value="false" default="true"/>
      <option name="HINT_SELECT" value=" " default="true"/>
      <option name="HINT_INSERT_TMP" value="APPEND" default="true"/>
      <option name="DROP_TABLE" value="true" default="true"/>
   </node>
   <node name="FT_ALL_APPOINTMENTS_TT_ES" type="CKM" km="CKM Oracle for Amplifon.BDFL_AMP">
      <option name="DROP_ERROR_TABLE" value="true" default="true"/>
      <option name="DROP_CHECK_TABLE" value="false" default="true"/>
      <option name="CREATE_ERROR_INDEX" value="true" default="true"/>
      <option name="CREATE_FLOW_INDEX" value="true" default="true"/>
      <option name="COMPATIBLE" value="9" default="true"/>
      <option name="VALIDATE" value="false" default="true"/>
      <option name="ENABLE_EDITION_SUPPORT" value="false" default="true"/>
      <option name="UPGRADE_ERROR_TABLE" value="false" default="true"/>
      <option name="FILTER_CURRENT_FL" value="true" default="true"/>
      <option name="ENABLE_DATA_QUALITY" value="true" default="true"/>
   </node>
   <node name="FILT_ACT" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="EXP_3" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN3" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="JOIN1" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="EXPRESSION1" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN4" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="RMAP_ES_CUST_STATUS_TRI_AP_RMA" type="LKM" km="LKM Oracle to Oracle Pull (DB Link).GLOBAL">
      <option name="SELECT_FROM_SOURCE_VIEW" value="false" default="true"/>
      <option name="USE_STAGE_TABLE" value="false" default="true"/>
      <option name="ADD_DRIVING_SITE_HINT" value="false" default="true"/>
      <option name="CREATE_DB_LINK" value="true" default="true"/>
      <option name="SOURCE_ACCESS_DB_LINK" value="" default="true"/>
   </node>
   <node name="OUT_RMAP_ES_CUST_STATUS_TRI" type="XKM" km="XKM Oracle Output Signature.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
   </node>
   <node name="DISTINCT__RMAP_ES_CUST_STATUS_" type="XKM" km="XKM SQL Distinct.GLOBAL"/>
   <node name="EXP_RMAP_ES_CUST_STATUS_TRI" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN_RMAP_ES_CUST_STATUS_TRI" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="FILT_CL_RMAP_ES_CUST_STATUS_TR" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="FILTER3" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="EXPRESSION" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="FILTER" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="APP_TRIAL" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="JOIN5" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="EXPRESSION2" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="FTB_ALL_APPOINTMENTS_BASE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="CF_SHOP_REMAPPING" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="CL_LIGHT_CUSTOMER_STATUS_RMAP_" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FILT_UM_RMAP_ES_CUST_STATUS_TR" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="UM_CU_S_CUSTOMER_MAPPING_RMAP_" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="EXPRESSION3" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="FTB_TRIAL_BASE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FT_CUSTOMER_BASE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FILTER1" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <target name="FT_ALL_APPOINTMENTS_TT_ES" resource="FT_ALL_APPOINTMENTS_TT_ES" model="STG_DMM_BDL" logicalSchema="LOG_STG_BDFL" forcedContext=""/>
</map-generation-info>]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[efb8aeb7-a78c-4d00-901c-795e9f069886]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String"><![CDATA[STG_DMM_BDL]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="ResName" type="java.lang.String"><![CDATA[FT_ALL_APPOINTMENTS_TT_ES]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[MAP_ES_FT_ALL_APPOINTMENTS_01]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[M]]></Field>
	<Field name="TableName" type="java.lang.String"><![CDATA[FT_ALL_APPOINTMENTS_TT_ES]]></Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String">null</Field>
	<Field name="VarOp" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1fe8781b-157b-4c3d-8d5d-8c968aa1a751]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_BEGIN]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[e7005e44-e80f-4341-bdb0-fb5f87cc1544]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[6679cc59-9924-4ff5-bec8-00454495af64]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Prepare: drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1c575a02-93c6-4e75-bb43-4f1cbfec8e85]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Prepare: drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[910bc28b-4b61-421b-8368-c640d8792320]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_MAIN]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[c08fbabe-c914-4b52-a191-6592c2beac3f]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_STG_BDFL_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[create table <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS_TT_ES", "LOG_STG_BDFL", "D") ?>
(
	X_AUD_DATASOURCE_ID	NUMBER NULL,
	X_AUD_SESSION_ID	NUMBER NULL,
	X_AUD_FROM_TS	TIMESTAMP(6) NULL,
	X_AUD_TO_TS	TIMESTAMP(6) NULL,
	X_AUD_CURRENT_FL	NUMBER NULL,
	X_AUD_AGENT_CD	VARCHAR2(100 CHAR) NULL,
	X_AUD_INSERT_TS	TIMESTAMP(6) NULL,
	X_AUD_UPDATE_TS	TIMESTAMP(6) NULL,
	X_AUD_COMPANY_CD	VARCHAR2(3 CHAR) NULL,
	COMPANY_CD	VARCHAR2(63 CHAR) NULL,
	DIVISION_CD	VARCHAR2(63 CHAR) NULL,
	SHOP_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_ID	VARCHAR2(63 CHAR) NULL,
	LAPTOP_CD	VARCHAR2(63 CHAR) NULL,
	COMPANY_HK	VARCHAR2(63 CHAR) NULL,
	SHOP_HK	VARCHAR2(63 CHAR) NULL,
	CUSTOMER_HK	VARCHAR2(63 CHAR) NULL,
	LOCATION_TYPE_HK	VARCHAR2(63 CHAR) NULL,
	CLC_STATUS_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_MARKETING_LIST_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_RESULT_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_TM_MARKETING_LIST_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_TM_RESULT_HK	VARCHAR2(63 CHAR) NULL,
	ENR_LAST_NBA_HK	VARCHAR2(63 CHAR) NULL,
	CTB_CONTACTABILITY_HK	VARCHAR2(63 CHAR) NULL,
	INT_LAST_INTERACTION_HK	VARCHAR2(63 CHAR) NULL,
	TST_LAST_TEST_HK	VARCHAR2(63 CHAR) NULL,
	TRI_LAST_TRIAL_HK	VARCHAR2(63 CHAR) NULL,
	COM_LAST_SALE_HK	VARCHAR2(63 CHAR) NULL,
	EMPLOYEE_HK	VARCHAR2(63 CHAR) NULL,
	TEST_RESULT_HK	VARCHAR2(63 CHAR) NULL,
	MEDIATYPE_CHANNEL_HK	VARCHAR2(63 CHAR) NULL,
	SERVICE_APPOINTMENT_HK	VARCHAR2(63 CHAR) NULL,
	MEDIATYPE_HK	VARCHAR2(63 CHAR) NULL,
	CAMPAIGN_HK	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_BOOKING_SK	NUMBER NULL,
	APPOINTMENT_SCHEDULING_SK	NUMBER NULL,
	APPOINTMENT_DURATION_QT	NUMBER NULL,
	APPOINTMENT_SHOP_CD	VARCHAR2(63 CHAR) NULL,
	CAMPAING_CD	VARCHAR2(63 CHAR) NULL,
	MEDIATYPE_CD	VARCHAR2(63 CHAR) NULL,
	LOCATION_CD	VARCHAR2(63 CHAR) NULL,
	RESULT_CD	VARCHAR2(63 CHAR) NULL,
	CHANNEL_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_BOOKING_DT	DATE NULL,
	APPOINTMENT_SCHEDULING_DT	DATE NULL,
	APPOINTMENT_ORIGIN_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_STATUS_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_STATUS_DETAIL_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_STATUS_DETAIL_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_TYPE_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_CATEGORY_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_ID_REF	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_DT_REF	DATE NULL,
	D_LAST_SALE_HOT_COLD_DT	DATE NULL,
	D_CLC_REFERENCE_DATE_DT	DATE NULL,
	APPOINTMENT_ID_LEAF	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_DT_LEAF	DATE NULL,
	APPOINTMENT_RESCHEDULATIONS_QT	NUMBER NULL,
	APPOINTMENT_DELAY_QT	NUMBER NULL,
	REASON_CLOSING_CD	VARCHAR2(63 CHAR) NULL,
	ORIGIN_FATHER_CD	VARCHAR2(63 CHAR) NULL,
	RESCHEDULING_RELATIONSHIP_DS	VARCHAR2(63 CHAR) NULL,
	INVOICING_APP_FL	NUMBER NULL,
	INVOICING_APP_AMOUNT_QT	NUMBER NULL,
	INVOICING_APP_UNITS	NUMBER NULL,
	WEEKS_TO_APPOINTMENT_QT	NUMBER NULL,
	DAYS_TO_APPOINTMENT_QT	NUMBER NULL,
	M_FROM_CALL_CENTER_FL	NUMBER NULL,
	M_FROM_WEB_FL	NUMBER NULL,
	M_FROM_SHOP_FL	NUMBER NULL,
	M_COMPLETED_FL	NUMBER NULL,
	M_FUTURE_APPOINTMENT_FL	NUMBER NULL,
	M_SCHEDULED_APPOINTMENT_FL	NUMBER NULL,
	M_BOOKED_APPOINTMENTS_FL	NUMBER NULL,
	M_CLIENT_ID	VARCHAR2(63 CHAR) NULL,
	M458_TIME_TO_APPOINTMENT_QT	NUMBER NULL,
	M_AGENDA_APPOINTMENTS_FL	NUMBER NULL,
	DAYCENTER_HK	VARCHAR2(63 CHAR) NULL,
	EMP_PROMOTER_HK	VARCHAR2(63 CHAR) NULL,
	M_SAME_STORE_GROWTH_PY_FL	NUMBER NULL,
	M_SAME_STORE_GROWTH_CY_FL	NUMBER NULL,
	D_LAST_TEST_DT	DATE NULL,
	D_LAST_TEST_REF_DT	DATE NULL,
	D_LAST_INTERACTION_DT	DATE NULL,
	D_LAST_INTERACTION_REF_DT	DATE NULL,
	M_CANCELED_FL	NUMBER NULL,
	MARKET_TYPE_LAST_SALE_HK	VARCHAR2(63 CHAR) NULL,
	TEST_AGEING_SK	NUMBER NULL,
	INTERACTION_AGEING_SK	NUMBER NULL,
	D_CANCELLATION_DATE_DT	DATE NULL,
	D_RESCHEDULED_DATE_DT	DATE NULL,
	D_CLOSE_DATE_DT	DATE NULL,
	D_LAST_UPDATE_DATE_DT	DATE NULL,
	IB_ID	NUMBER NULL,
	STATUS_DESCR	VARCHAR2(63 CHAR) NULL,
	CC_OPERATOR	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_STATUS_ENHANCED_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_STATUS_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_REASON_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_RESULT_DS	VARCHAR2(255 CHAR) NULL,
	APPOINTMENT_BOOKING_USER_DS	VARCHAR2(255 CHAR) NULL,
	APPT_BOOKING_USERGROUP_CD	VARCHAR2(63 CHAR) NULL,
	APPT_WEB_BOOKING_USER_CD	VARCHAR2(63 CHAR) NULL,
	APPT_WEB_BOOKING_USER_DS	VARCHAR2(255 CHAR) NULL,
	APPT_WEB_BOOKING_USERGROUP_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_UPDATE_USER_DS	VARCHAR2(255 CHAR) NULL,
	APPT_UPDATE_USERGROUP_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_BOOKING_USER_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_UPDATE_DT	DATE NULL,
	APPOINTMENT_UPDATE_USER_CD	VARCHAR2(63 CHAR) NULL,
	REASON_BOOKING_OUT_CD	VARCHAR2(63 CHAR) NULL,
	REASON_BOOKING_OUT_DS	VARCHAR2(255 CHAR) NULL,
	REASON_BOOKING_OUT_QT	NUMBER NULL,
	IB_SCHEDULING_SK	NUMBER NULL,
	IB_BOOKING_SK	NUMBER NULL,
	APPOINTMENT_FATHER_ID	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_FATHER_DT	DATE NULL,
	MEDICAL_CHANNEL_KEY	VARCHAR2(63 CHAR) NULL,
	M_BUSINESS_APP_FL	NUMBER NULL
)
NOLOGGING  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[33c5dbbd-df58-4c06-a2a8-04add5f526f9]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[110]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Create target table ]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Append TMP for Amplifon]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[  insert /*+ APPEND */ into <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS_TT_ES", "LOG_STG_BDFL", "D") ?>
  (
          X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_ID_REF,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	APPOINTMENT_ID_LEAF,
	APPOINTMENT_DT_LEAF,
	APPOINTMENT_RESCHEDULATIONS_QT,
	REASON_CLOSING_CD,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	APPOINTMENT_FATHER_ID,
	APPOINTMENT_FATHER_DT
  )
  select  
         4,
	#BDFL_AMP.V_SESSION_NO,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS'),
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS'),
	1,
	'MAP_ES_FT_ALL_APPOINTMENTS_01' || ' (' || '<?=odiRef.getContext("CTX_CODE") ?>' || ')',
	SYSTIMESTAMP,
	SYSTIMESTAMP,
	INLINE_VIEW_5.COMPANY_CD,
	INLINE_VIEW_5.COMPANY_CD,
	INLINE_VIEW_5.DIVISION_CD,
	INLINE_VIEW_5.SHOP_CD,
	INLINE_VIEW_5.APPOINTMENT_ID,
	INLINE_VIEW_5.LAPTOP_CD,
	STANDARD_HASH( INLINE_VIEW_5.COMPANY_CD||INLINE_VIEW_5.TRG_DIVISION_CD),
	CASE WHEN
INLINE_VIEW_5.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_5.COMPANY_CD||INLINE_VIEW_5.DIVISION_CD||INLINE_VIEW_5.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END,
	INLINE_VIEW_5.CUSTOMER_HK,
	CASE WHEN
INLINE_VIEW_5.LOCATION_TYPE_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_5.COMPANY_CD||INLINE_VIEW_5.DIVISION_CD||INLINE_VIEW_5.LOCATION_TYPE_CD)
ELSE STANDARD_HASH('-1')
END,
	NVL(INLINE_VIEW_5.CLC_STATUS_HK,'D961F70D39EE00CF78D4D476B80EF3AD5ABE128C'),
	INLINE_VIEW_5.CRM_LAST_MARKETING_LIST_HK,
	INLINE_VIEW_5.CRM_LAST_RESULT_HK,
	INLINE_VIEW_5.CRM_LAST_TM_MARKETING_LIST_HK,
	INLINE_VIEW_5.CRM_LAST_TM_RESULT_HK,
	INLINE_VIEW_5.ENR_LAST_NBA_HK,
	INLINE_VIEW_5.CTB_CONTACTABILITY_HK,
	INLINE_VIEW_5.INT_LAST_INTERACTION_HK,
	INLINE_VIEW_5.TST_LAST_TEST_HK,
	INLINE_VIEW_5.TRI_LAST_TRIAL_HK,
	INLINE_VIEW_5.COM_LAST_SALE_HK,
	CASE WHEN
INLINE_VIEW_5.EMPLOYEE_CD IS NOT NULL
AND INLINE_VIEW_5.APPOINTMENT_SHOP_CD IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_5.COMPANY_CD||INLINE_VIEW_5.DIVISION_CD||INLINE_VIEW_5.EMPLOYEE_CD||INLINE_VIEW_5.APPOINTMENT_SHOP_CD)
ELSE STANDARD_HASH('-1')
END,
	CASE WHEN 
INLINE_VIEW_5.SERVICE_CD IS NOT NULL
THEN
STANDARD_HASH(INLINE_VIEW_5.COMPANY_CD||INLINE_VIEW_5.DIVISION_CD||INLINE_VIEW_5.SERVICE_CD)
ELSE
STANDARD_HASH('-1')
END,
	CASE WHEN
INLINE_VIEW_5.MEDIATYPE_CODE IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_5.COMPANY_CODE||INLINE_VIEW_5.DIVISION_CODE||INLINE_VIEW_5.MEDIATYPE_CODE)
ELSE STANDARD_HASH('-1')
END,
	CASE WHEN
INLINE_VIEW_5.CAMPAIGN_CODE IS NOT NULL
THEN STANDARD_HASH(INLINE_VIEW_5.COMPANY_CODE||INLINE_VIEW_5.DIVISION_CODE||INLINE_VIEW_5.CAMPAIGN_CODE)
ELSE STANDARD_HASH('-1')
END,
	TO_CHAR(TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT), 'YYYYMMDD'),
	TO_CHAR(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT, 'YYYYMMDD'),
	INLINE_VIEW_5.APPOINTMENT_DURATION_QT,
	INLINE_VIEW_5.APPOINTMENT_SHOP_CD,
	INLINE_VIEW_5.CAMPAIGN_CODE,
	INLINE_VIEW_5.MEDIATYPE_CODE,
	INLINE_VIEW_5.RESULT_CD,
	TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT),
	TRUNC(INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT),
	INLINE_VIEW_5.APPOINTMENT_STATUS_CD,
	INLINE_VIEW_5.APPOINTMENT_ID_REF,
	INLINE_VIEW_5.APPOINTMENT_DT_REF,
	INLINE_VIEW_5.COM_LAST_HA_SALE_DT,
	CASE WHEN INLINE_VIEW_5.STATUS_ID = 6 
     THEN TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - 1
     ELSE TRUNC(INLINE_VIEW_5.CREATION_DATE_DT) - #BDFL_AMP.V_TRIAL_LESS_DAYS
END,
	INLINE_VIEW_5.APPOINTMENT_ID_LEAF,
	INLINE_VIEW_5.APPOINTMENT_DT_LEAF,
	INLINE_VIEW_5.APPOINTMENT_RESCHEDULATIONS_QT,
	INLINE_VIEW_5.REASON_CLOSING_CD,
	INLINE_VIEW_5.INVOICING_APP_FL,
	INLINE_VIEW_5.COL_5,
	INLINE_VIEW_5.COL_6,
	CASE INLINE_VIEW_5.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_5.USERINSERT_CD),1,6) = 'D08\C_' OR SUBSTR(UPPER(INLINE_VIEW_5.USERINSERT_CD),1,2) = 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_5.RESULT_CD),1,1) = '2'
        THEN 1 ELSE 0 END
END,
	0,
	CASE INLINE_VIEW_5.DIVISION_CD
  WHEN '001' THEN
    CASE 
      WHEN (SUBSTR(UPPER(INLINE_VIEW_5.USERINSERT_CD),1,6) <> 'D08\C_' AND SUBSTR(UPPER(INLINE_VIEW_5.USERINSERT_CD),1,2) <> 'C_')
        THEN 1 ELSE 0 END
  WHEN '002' THEN
    CASE
      WHEN SUBSTR(UPPER(INLINE_VIEW_5.RESULT_CD),1,1) <> '2'
        THEN 1 ELSE 0 END
END,
	CASE 
  WHEN INLINE_VIEW_5.APPOINTMENT_STATUS_CD IN ('C', 'K') THEN 1 
  ELSE 0 
END,
	CASE WHEN INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT >= SYSDATE-1 THEN 1 ELSE 0 END,
	CASE
  WHEN INLINE_VIEW_5.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_5.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_5.REASON_CLOSING_CD IN ('04','08')) THEN 0
  ELSE 1
END,
	CASE 
  WHEN INLINE_VIEW_5.MASTER_CUSTOMER_CD IS NOT NULL 
  THEN INLINE_VIEW_5.MASTER_COMPANY_CD||INLINE_VIEW_5.MASTER_DIVISION_CD||INLINE_VIEW_5.MASTER_CUSTOMER_CD
  ELSE NULL
END,
	TRUNC( INLINE_VIEW_5.APPOINTMENT_SCHEDULING_DT)- TRUNC(INLINE_VIEW_5.APPOINTMENT_BOOKING_DT),
	CASE 
  WHEN INLINE_VIEW_5.APPOINTMENT_STATUS_CD IN ('C', 'K', 'A') 
      OR (INLINE_VIEW_5.APPOINTMENT_STATUS_CD IN ('N') AND INLINE_VIEW_5.REASON_CLOSING_CD IN ('05', '06'))
  THEN 1 
  ELSE 0 
END,
	CASE
  WHEN INLINE_VIEW_5.APPOINTMENT_STATUS_CD IN ('X','R','E') OR 
    (INLINE_VIEW_5.APPOINTMENT_STATUS_CD = 'N' AND INLINE_VIEW_5.REASON_CLOSING_CD IN ('04','08')) THEN 1
  ELSE 0
END,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.TST_LAST_TEST_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.TST_LAST_TEST_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.TST_LAST_TEST_DT)
    ELSE 3651
END,
	CASE 
 WHEN  TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.INT_LAST_INTERACTION_DT) IS NULL 
            THEN NULL
 WHEN  TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.INT_LAST_INTERACTION_DT) < 3651 
            THEN TRUNC(INLINE_VIEW_5.COL_8) - TRUNC(INLINE_VIEW_5.INT_LAST_INTERACTION_DT)
    ELSE 3651
END,
	INLINE_VIEW_5.COL,
	INLINE_VIEW_5.APPOINTMENT_ID_REF,
	INLINE_VIEW_5.APPOINTMENT_DT_REF
  from	(
SELECT 
  UM_CU_B_ACTIVITY_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_B_ACTIVITY_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_B_ACTIVITY_1.CAMPAIGN_CODE AS CAMPAIGN_CODE ,
  UM_CU_B_ACTIVITY_1.MEDIATYPE_CODE AS MEDIATYPE_CODE ,
  UM_CU_B_ACTIVITY_1.REFERENCE_DATE AS REFERENCE_DATE ,
  UM_CU_B_ACTIVITY_1.REFERENCE_NUMBER AS REFERENCE_NUMBER ,
  INLINE_VIEW_4.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_4.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_4.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_4.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_4.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_4.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_4.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_4.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_4.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_4.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_4.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_4.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_4.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_4.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_4.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_4.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW_4.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_4.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW_4.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW_4.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW_4.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_4.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_4.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_4.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  INLINE_VIEW_4.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_4.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_4.COL AS COL ,
  INLINE_VIEW_4.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_4.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_4.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_4.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_4.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_4.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_4.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_4.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_4.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_4.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_4.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_4.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_4.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_4.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_4.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_4.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_4.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_4.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_4.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_4.COL_1 AS COL_1 ,
  INLINE_VIEW_4.COL_2 AS COL_2 ,
  INLINE_VIEW_4.COL_3 AS COL_3 ,
  INLINE_VIEW_4.COL_4 AS COL_4 ,
  INLINE_VIEW_4.COL_5 AS COL_5 ,
  INLINE_VIEW_4.COL_6 AS COL_6 ,
  INLINE_VIEW_4.COL_7 AS COL_7 ,
  INLINE_VIEW_4.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_4.STATUS_ID AS STATUS_ID ,
  INLINE_VIEW_4.STATUS_FROM_DT AS STATUS_FROM_DT ,
  INLINE_VIEW_4.STATUS_TO_DT AS STATUS_TO_DT ,
  INLINE_VIEW_4.COL_8 AS COL_8 ,
  FT_CUSTOMER_BASE.CLC_STATUS_HK AS CLC_STATUS_HK ,
  FT_CUSTOMER_BASE.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  FT_CUSTOMER_BASE.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  FT_CUSTOMER_BASE.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  FT_CUSTOMER_BASE.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  FT_CUSTOMER_BASE.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  FT_CUSTOMER_BASE.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  FT_CUSTOMER_BASE.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  FT_CUSTOMER_BASE.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  FT_CUSTOMER_BASE.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  FT_CUSTOMER_BASE.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  FT_CUSTOMER_BASE.COMPANY_CD AS COMPANY_CD_3 ,
  FT_CUSTOMER_BASE.DIVISION_CD AS DIVISION_CD_3 ,
  FT_CUSTOMER_BASE.CUSTOMER_CD AS CUSTOMER_CD_1 ,
  FT_CUSTOMER_BASE.VALID_FROM_DT AS VALID_FROM_DT ,
  FT_CUSTOMER_BASE.VALID_TO_DT AS VALID_TO_DT ,
  FT_CUSTOMER_BASE.INT_LAST_INTERACTION_DT AS INT_LAST_INTERACTION_DT ,
  FT_CUSTOMER_BASE.TST_LAST_TEST_DT AS TST_LAST_TEST_DT ,
  FT_CUSTOMER_BASE.COM_LAST_HA_SALE_DT AS COM_LAST_HA_SALE_DT ,
  ROW_NUMBER() OVER(
PARTITION by INLINE_VIEW_4.COMPANY_CD,
             INLINE_VIEW_4.DIVISION_CD,
             INLINE_VIEW_4.APPOINTMENT_ID,
             INLINE_VIEW_4.SHOP_CD,
             INLINE_VIEW_4.LAPTOP_CD
    ORDER BY TRUNC(UM_CU_B_ACTIVITY_1.REFERENCE_DATE) DESC,
             UM_CU_B_ACTIVITY_1.REFERENCE_NUMBER     DESC  ) AS COL_9   
FROM 
  ((
SELECT 
  INLINE_VIEW_3.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_3.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_3.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_3.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_3.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_3.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_3.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_3.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_3.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_3.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_3.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_3.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_3.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_3.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_3.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_3.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_3.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_3.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW_3.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_3.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW_3.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW_3.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW_3.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_3.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_3.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_3.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  INLINE_VIEW_3.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_3.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_3.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_3.COL AS COL ,
  INLINE_VIEW_3.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_3.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_3.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_3.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_3.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_3.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_3.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_3.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_3.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_3.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_3.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_3.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_3.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_3.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_3.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_3.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_3.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_3.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_3.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_3.COL_1 AS COL_1 ,
  INLINE_VIEW_3.COL_2 AS COL_2 ,
  INLINE_VIEW_3.COL_3 AS COL_3 ,
  INLINE_VIEW_3.COL_4 AS COL_4 ,
  INLINE_VIEW_3.COL_5 AS COL_5 ,
  INLINE_VIEW_3.COL_6 AS COL_6 ,
  INLINE_VIEW_3.COL_7 AS COL_7 ,
  DISTINCT__RMAP_ES_CUST_STATUS_.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_ID AS STATUS_ID ,
  DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_TO_DT AS STATUS_TO_DT ,
  CASE WHEN INLINE_VIEW_3.CUSTOMER_CD IS NOT NULL
     THEN CASE WHEN INLINE_VIEW_3.COL_4 = 1 AND INLINE_VIEW_3.COMPANY_CD_2 IS NOT NULL
               THEN CASE WHEN DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_ID = 6 
                         THEN TRUNC(INLINE_VIEW_3.CREATION_DATE_DT) - 1
                         ELSE TRUNC(INLINE_VIEW_3.CREATION_DATE_DT) - #BDFL_AMP.V_TRIAL_LESS_DAYS
                    END
               ELSE TRUNC(INLINE_VIEW_3.APPOINTMENT_BOOKING_DT) - #BDFL_AMP.V_APPOINTMENT_LESS_DAYS
          END
     ELSE NULL
END AS COL_8   
FROM 
  (
SELECT 
  INLINE_VIEW_2.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_2.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_2.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_2.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_2.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_2.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_2.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_2.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_2.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_2.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_2.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_2.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_2.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_2.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_2.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_2.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW_2.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_2.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW_2.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW_2.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW_2.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_2.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_2.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_2.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  INLINE_VIEW_2.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_2.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_2.COL AS COL ,
  INLINE_VIEW_2.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_2.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_2.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_2.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_2.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_2.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_2.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_2.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_2.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_2.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_2.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_2.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_2.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_2.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_2.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_2.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_2.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_2.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_2.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_2.COL_1 AS COL_1 ,
  INLINE_VIEW_2.COL_2 AS COL_2 ,
  INLINE_VIEW_2.COL_3 AS COL_3 ,
  INLINE_VIEW_2.COL_4 AS COL_4 ,
  INLINE_VIEW_2.COL_5 AS COL_5 ,
  INLINE_VIEW_2.COL_6 AS COL_6 ,
  INLINE_VIEW_2.COL_7 AS COL_7   
FROM 
  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW_1.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_1.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW_1.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW_1.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW_1.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  INLINE_VIEW_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW_1.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  INLINE_VIEW_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  INLINE_VIEW_1.SIDE_CD AS SIDE_CD ,
  INLINE_VIEW_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  INLINE_VIEW_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  INLINE_VIEW_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  INLINE_VIEW_1.SALE_DATE_DT AS SALE_DATE_DT ,
  INLINE_VIEW_1.QUANTITY_QT AS QUANTITY_QT ,
  INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  INLINE_VIEW_1.MASTER_COMPANY_CD_1 AS MASTER_COMPANY_CD_1 ,
  INLINE_VIEW_1.MASTER_DIVISION_CD_1 AS MASTER_DIVISION_CD_1 ,
  INLINE_VIEW_1.MASTER_CUSTOMER_CD_1 AS MASTER_CUSTOMER_CD_1 ,
  INLINE_VIEW_1.COL_1 AS COL_1 ,
  INLINE_VIEW_1.COL_2 AS COL_2 ,
  INLINE_VIEW_1.COL_3 AS COL_3 ,
  INLINE_VIEW_1.COL_4 AS COL_4 ,
  SUM(INLINE_VIEW_1.LIST_PRICE_AMOUNT_AM) OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_5 ,
  SUM(INLINE_VIEW_1.QUANTITY_QT) OVER(PARTITION BY
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
) AS COL_6 ,
  ROW_NUMBER() OVER(PARTITION BY 
  INLINE_VIEW_1.COMPANY_CD,
  INLINE_VIEW_1.DIVISION_CD,
  INLINE_VIEW_1.SHOP_CD,
  INLINE_VIEW_1.LAPTOP_CD,
  INLINE_VIEW_1.APPOINTMENT_ID
    ORDER BY    
    TRUNC(COALESCE(INLINE_VIEW_1.DELIVERY_DATE_DT,  INLINE_VIEW_1.CREATION_DATE_DT)) DESC,
    INLINE_VIEW_1.ORDER_DATE_DT DESC,
    INLINE_VIEW_1.ORDER_NUMBER_ID DESC
) AS COL_7   
FROM 
  (
SELECT 
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.EMPLOYEE_CD AS EMPLOYEE_CD ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.CUSTOMER_CD AS CUSTOMER_CD ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.SERVICE_CD AS SERVICE_CD ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  INLINE_VIEW.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.USERINSERT_CD AS USERINSERT_CD ,
  INLINE_VIEW.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  INLINE_VIEW.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  INLINE_VIEW.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  INLINE_VIEW.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  INLINE_VIEW.COL AS COL ,
  INLINE_VIEW.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD_1 AS SHOP_CD_1 ,
  INLINE_VIEW.TRG_DIVISION_CD AS TRG_DIVISION_CD ,
  FTB_TRIAL_BASE_1.COMPANY_CD AS COMPANY_CD_2 ,
  FTB_TRIAL_BASE_1.DIVISION_CD AS DIVISION_CD_2 ,
  FTB_TRIAL_BASE_1.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE_1.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE_1.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE_1.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE_1.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE_1.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE_1.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE_1.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE_1.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE_1.MASTER_COMPANY_CD AS MASTER_COMPANY_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_DIVISION_CD AS MASTER_DIVISION_CD_1 ,
  FTB_TRIAL_BASE_1.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD_1 ,
  FTB_TRIAL_BASE_1.COL AS COL_1 ,
  FTB_TRIAL_BASE_1.COL_1 AS COL_2 ,
  ROW_NUMBER() OVER (PARTITION BY INLINE_VIEW.APPOINTMENT_ID, 
 INLINE_VIEW.LAPTOP_CD,
 INLINE_VIEW.SHOP_CD, 
 INLINE_VIEW.COMPANY_CD,
 INLINE_VIEW.DIVISION_CD,
 FTB_TRIAL_BASE_1.SIDE_CD
 ORDER BY 
    TRUNC(COALESCE(FTB_TRIAL_BASE_1.DELIVERY_DATE_DT,  FTB_TRIAL_BASE_1.CREATION_DATE_DT)) DESC,
    FTB_TRIAL_BASE_1.ORDER_DATE_DT DESC,
    FTB_TRIAL_BASE_1.ORDER_NUMBER_ID DESC
 ) AS COL_3 ,
  CASE WHEN INLINE_VIEW.APPOINTMENT_CATEGORY_CD ='2' 
THEN 1 ELSE 0 END AS COL_4   
FROM 
  (
SELECT 
  FTB_TRIAL_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_TRIAL_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_TRIAL_BASE.ORDER_DATE_DT AS ORDER_DATE_DT ,
  FTB_TRIAL_BASE.ORDER_NUMBER_ID AS ORDER_NUMBER_ID ,
  FTB_TRIAL_BASE.SIDE_CD AS SIDE_CD ,
  FTB_TRIAL_BASE.CREATION_DATE_DT AS CREATION_DATE_DT ,
  FTB_TRIAL_BASE.CANCELLATION_DATE_DT AS CANCELLATION_DATE_DT ,
  FTB_TRIAL_BASE.DELIVERY_DATE_DT AS DELIVERY_DATE_DT ,
  FTB_TRIAL_BASE.RETURN_DATE_DT AS RETURN_DATE_DT ,
  FTB_TRIAL_BASE.SALE_DATE_DT AS SALE_DATE_DT ,
  FTB_TRIAL_BASE.QUANTITY_QT AS QUANTITY_QT ,
  FTB_TRIAL_BASE.LIST_PRICE_AMOUNT_AM AS LIST_PRICE_AMOUNT_AM ,
  FTB_TRIAL_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_TRIAL_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_TRIAL_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE
  WHEN FTB_TRIAL_BASE.MASTER_CUSTOMER_CD IS NOT NULL
  THEN STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) 
  ELSE STANDARD_HASH ('-1')
END AS COL ,
  STANDARD_HASH ( FTB_TRIAL_BASE.MASTER_COMPANY_CD || FTB_TRIAL_BASE.MASTER_DIVISION_CD || FTB_TRIAL_BASE.MASTER_CUSTOMER_CD ) AS COL_1   
FROM 
  <?= odiRef.getObjectName("L", "FTB_TRIAL_BASE", "LOG_BDFL", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> FTB_TRIAL_BASE  
  ) FTB_TRIAL_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.SHOP_CD AS SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.EMPLOYEE_CD AS EMPLOYEE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LAPTOP_CD AS LAPTOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_CD AS CUSTOMER_CD ,
  FTB_ALL_APPOINTMENTS_BASE.CUSTOMER_HK AS CUSTOMER_HK ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FTB_ALL_APPOINTMENTS_BASE.SERVICE_CD AS SERVICE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FTB_ALL_APPOINTMENTS_BASE.LOCATION_TYPE_CD AS LOCATION_TYPE_CD ,
  FTB_ALL_APPOINTMENTS_BASE.RESULT_CD AS RESULT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_CATEGORY_CD AS APPOINTMENT_CATEGORY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FTB_ALL_APPOINTMENTS_BASE.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FTB_ALL_APPOINTMENTS_BASE.USERINSERT_CD AS USERINSERT_CD ,
  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_UPDATE_DT AS APPOINTMENT_UPDATE_DT ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_COMPANY_CD AS MASTER_COMPANY_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_DIVISION_CD AS MASTER_DIVISION_CD ,
  FTB_ALL_APPOINTMENTS_BASE.MASTER_CUSTOMER_CD AS MASTER_CUSTOMER_CD ,
  CASE 
  WHEN  FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD in ('X', 'R', 'E') OR
        (FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_STATUS_CD = 'N' AND FTB_ALL_APPOINTMENTS_BASE.REASON_CLOSING_CD IN ('04','08'))
        THEN   FTB_ALL_APPOINTMENTS_BASE.APPOINTMENT_UPDATE_DT 
  ELSE NULL 
END AS COL ,
  CF_SHOP_REMAPPING.COMPANY_CD AS COMPANY_CD_1 ,
  CF_SHOP_REMAPPING.DIVISION_CD AS DIVISION_CD_1 ,
  CF_SHOP_REMAPPING.SHOP_CD AS SHOP_CD_1 ,
  CF_SHOP_REMAPPING.TRG_DIVISION_CD AS TRG_DIVISION_CD   
FROM 
  <?= odiRef.getObjectName("L", "FTB_ALL_APPOINTMENTS_BASE", "LOG_BDFL", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> FTB_ALL_APPOINTMENTS_BASE  LEFT OUTER JOIN  <?= odiRef.getObjectName("L", "CF_SHOP_REMAPPING", "LOG_BDFL_DMM", "D") ?> CF_SHOP_REMAPPING  
    ON  FTB_ALL_APPOINTMENTS_BASE.COMPANY_CD  =  CF_SHOP_REMAPPING.COMPANY_CD AND
FTB_ALL_APPOINTMENTS_BASE.DIVISION_CD =  CF_SHOP_REMAPPING.DIVISION_CD AND
FTB_ALL_APPOINTMENTS_BASE.SHOP_CD     =  CF_SHOP_REMAPPING.SHOP_CD
  ) INLINE_VIEW  
    ON  INLINE_VIEW.COMPANY_CD  = FTB_TRIAL_BASE_1.COMPANY_CD  AND
INLINE_VIEW.DIVISION_CD = FTB_TRIAL_BASE_1.DIVISION_CD AND
INLINE_VIEW.CUSTOMER_HK = FTB_TRIAL_BASE_1.COL    AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) > FTB_TRIAL_BASE_1.CREATION_DATE_DT AND
TRUNC(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT) 
                                     <= COALESCE(FTB_TRIAL_BASE_1.CANCELLATION_DATE_DT
                                               , FTB_TRIAL_BASE_1.RETURN_DATE_DT, FTB_TRIAL_BASE_1.SALE_DATE_DT
                                               , ADD_MONTHS(INLINE_VIEW.APPOINTMENT_SCHEDULING_DT,12) )
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_3 = 1
) 
  ) INLINE_VIEW_2  
WHERE
  (INLINE_VIEW_2.COL_7 = 1
) 
  ) INLINE_VIEW_3  LEFT OUTER JOIN  (
SELECT 
  DISTINCT 
  (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) AS COMPANY_CD ,
  (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) AS DIVISION_CD ,
  (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD)) AS CUSTOMER_CD ,
  STANDARD_HASH((COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD)) || (COALESCE(UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE,CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD))) AS CUSTOMER_HK ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_TO_DT AS STATUS_TO_DT ,
  CASE WHEN CL_LIGHT_CUSTOMER_STATUS_RMA_1.STATUS_ID = 6 
     THEN COALESCE(CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_HEADER_DT, CL_LIGHT_CUSTOMER_STATUS_RMA_1.LAST_HA_ITEM_H_DT)
     ELSE NULL
END AS D_CLC_LAST_SALE_HOT_COLD_DT   
FROM 
  (
SELECT 
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD AS COMPANY_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.DIVISION_CD AS DIVISION_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.CUSTOMER_CD AS CUSTOMER_CD ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_ID AS STATUS_ID ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_FROM_DT AS STATUS_FROM_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.STATUS_TO_DT AS STATUS_TO_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_HEADER_DT AS LAST_HA_HEADER_DT ,
  CL_LIGHT_CUSTOMER_STATUS_RMAP_.LAST_HA_ITEM_H_DT AS LAST_HA_ITEM_H_DT   
FROM 
  <?= odiRef.getObjectName("L", "CL_LIGHT_CUSTOMER_STATUS", "LOG_EDW", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> CL_LIGHT_CUSTOMER_STATUS_RMAP_  
WHERE
  (CL_LIGHT_CUSTOMER_STATUS_RMAP_.COMPANY_CD='002'
) 
  ) CL_LIGHT_CUSTOMER_STATUS_RMA_1  LEFT OUTER JOIN  (
SELECT 
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL AS X_AUD_CURRENT_FL ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_COMPANY_CODE AS MASTER_COMPANY_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_DIVISION_CODE AS MASTER_DIVISION_CODE ,
  UM_CU_S_CUSTOMER_MAPPING_RMAP_.MASTER_CUSTOMER_CODE AS MASTER_CUSTOMER_CODE   
FROM 
  <?= odiRef.getObjectName("L", "UM_CU_S_CUSTOMER_MAPPING", "LOG_EDW", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE") ?> UM_CU_S_CUSTOMER_MAPPING_RMAP_  
WHERE
  (UM_CU_S_CUSTOMER_MAPPING_RMAP_.X_AUD_CURRENT_FL=1 AND 
UM_CU_S_CUSTOMER_MAPPING_RMAP_.COMPANY_CODE='002'
) 
  ) UM_CU_S_CUSTOMER_MAPPING_RMA_1  
    ON  CL_LIGHT_CUSTOMER_STATUS_RMA_1.COMPANY_CD  = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_COMPANY_CODE  AND 
CL_LIGHT_CUSTOMER_STATUS_RMA_1.DIVISION_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_DIVISION_CODE AND
CL_LIGHT_CUSTOMER_STATUS_RMA_1.CUSTOMER_CD = UM_CU_S_CUSTOMER_MAPPING_RMA_1.MASTER_CUSTOMER_CODE
  ) DISTINCT__RMAP_ES_CUST_STATUS_  
    ON  INLINE_VIEW_3.COL_2                = DISTINCT__RMAP_ES_CUST_STATUS_.CUSTOMER_HK AND
TRUNC(INLINE_VIEW_3.CREATION_DATE_DT) - 1 >= DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_FROM_DT AND
TRUNC(INLINE_VIEW_3.CREATION_DATE_DT) - 1  < NVL(TRUNC(DISTINCT__RMAP_ES_CUST_STATUS_.STATUS_TO_DT), TO_DATE('2099-12-31', 'YYYY-MM-DD'))
  ) INLINE_VIEW_4  LEFT OUTER JOIN  <?= odiRef.getObjectName("L", "FT_CUSTOMER_BASE", "LOG_BDFL_DMM", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> FT_CUSTOMER_BASE  
    ON  INLINE_VIEW_4.COMPANY_CD=FT_CUSTOMER_BASE.COMPANY_CD
AND
INLINE_VIEW_4.DIVISION_CD=FT_CUSTOMER_BASE.DIVISION_CD
AND
INLINE_VIEW_4.CUSTOMER_CD=FT_CUSTOMER_BASE.CUSTOMER_CD
AND 
INLINE_VIEW_4.COL_8 >= FT_CUSTOMER_BASE.VALID_FROM_DT
AND
INLINE_VIEW_4.COL_8 < FT_CUSTOMER_BASE.VALID_TO_DT
     )  LEFT OUTER JOIN  (
SELECT 
  UM_CU_B_ACTIVITY.COMPANY_CODE AS COMPANY_CODE ,
  UM_CU_B_ACTIVITY.DIVISION_CODE AS DIVISION_CODE ,
  UM_CU_B_ACTIVITY.CAMPAIGN_CODE AS CAMPAIGN_CODE ,
  UM_CU_B_ACTIVITY.MEDIATYPE_CODE AS MEDIATYPE_CODE ,
  UM_CU_B_ACTIVITY.REFERENCE_DATE AS REFERENCE_DATE ,
  UM_CU_B_ACTIVITY.REFERENCE_NUMBER AS REFERENCE_NUMBER   
FROM 
  <?= odiRef.getObjectName("L", "UM_CU_B_ACTIVITY", "LOG_EDW", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE") ?> UM_CU_B_ACTIVITY  
WHERE
  (UM_CU_B_ACTIVITY.COMPANY_CODE = '002'
AND UM_CU_B_ACTIVITY.X_AUD_CURRENT_FL = 1
) 
  ) UM_CU_B_ACTIVITY_1  
    ON  INLINE_VIEW_4.COMPANY_CD=UM_CU_B_ACTIVITY_1.COMPANY_CODE
AND
INLINE_VIEW_4.DIVISION_CD=UM_CU_B_ACTIVITY_1.DIVISION_CODE
AND
INLINE_VIEW_4.APPOINTMENT_ID=UM_CU_B_ACTIVITY_1.REFERENCE_NUMBER
AND
TRUNC(INLINE_VIEW_4.APPOINTMENT_SCHEDULING_DT)=TRUNC(UM_CU_B_ACTIVITY_1.REFERENCE_DATE)
  ) INLINE_VIEW_5
  where	
          (1=1)
   and (INLINE_VIEW_5.COL_9 = 1)
     ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f93685cc-73d0-4fcd-bb9a-944fd64f8b57]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String"><![CDATA[I]]></Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[110]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[120]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Insert new rows]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Append TMP for Amplifon]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[drop table <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS_TT_ES", "LOG_STG_BDFL", "D") ?> purge  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[39537394-b676-4fe2-9cd2-e6867b0f0aca]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[100]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Drop target table]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Append TMP for Amplifon]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[3379aa59-a045-426d-9651-e51dfa0d10f1]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
String srcUserName = odiRef.getInfo("SRC_USER_NAME");
String srcServerInstance = odiRef.getInfo("SRC_DSERV_NAME");
String srcSID = "";
if (srcServerInstance != null && srcServerInstance.trim().length() != 0) {
  srcSID = srcServerInstance;
} else {
  String srcJDBCURL = odiRef.getInfo("SRC_JAVA_URL");
  if (srcJDBCURL !=null && srcJDBCURL.trim().length() != 0) {
    srcSID = srcJDBCURL.substring(srcJDBCURL.lastIndexOf("@") + 1);
    srcSID = srcSID.substring(srcSID.lastIndexOf(":") + 1);
    if (srcSID.lastIndexOf("/") >= 0){
      srcSID = srcSID.substring(srcSID.lastIndexOf("/") + 1);
    }
  }
}
srcSID = srcSID.trim();
if (srcSID.length() == 0) {
  throw new OdiKMException("Failed calculating source SID.");
}
?>
create database link <?=dblinkToSrc ?> connect to <?=srcUserName ?> identified by <@=odiRef.getInfo("SRC_PASS") @> using '<?=srcSID ?>'
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[49db3725-5f85-4fc5-9939-471b4d5ffd87]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Create database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
String srcUserName = odiRef.getInfo("SRC_USER_NAME");
String srcServerInstance = odiRef.getInfo("SRC_DSERV_NAME");
String srcSID = "";
if (srcServerInstance != null && srcServerInstance.trim().length() != 0) {
  srcSID = srcServerInstance;
} else {
  String srcJDBCURL = odiRef.getInfo("SRC_JAVA_URL");
  if (srcJDBCURL !=null && srcJDBCURL.trim().length() != 0) {
    srcSID = srcJDBCURL.substring(srcJDBCURL.lastIndexOf("@") + 1);
    srcSID = srcSID.substring(srcSID.lastIndexOf(":") + 1);
    if (srcSID.lastIndexOf("/") >= 0){
      srcSID = srcSID.substring(srcSID.lastIndexOf("/") + 1);
    }
  }
}
srcSID = srcSID.trim();
if (srcSID.length() == 0) {
  throw new OdiKMException("Failed calculating source SID.");
}
?>
create database link <?=dblinkToSrc ?> connect to <?=srcUserName ?> identified by <@=odiRef.getInfo("SRC_PASS") @> using '<?=srcSID ?>'
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[7796ab5e-804a-42b9-8e2f-9e8f53d67bdc]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[80]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Create database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[36428283-32a4-4392-a9ed-f8595b2b3a13]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[130]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_CLEANUP]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[c15786d4-2b00-4650-b55c-9d9a7de00fae]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[130]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d8aa135a-614b-4b24-8899-61c7d330e210]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[150]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_STG_BDFL]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("FALSE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[013fac5d-87b6-4da4-b86c-44bc0f0ad270]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[160]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String"><![CDATA[<map-generation-info>
   <node name="MED_02" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="MED_01" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN4" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="AGGREGATE" type="XKM" km="XKM SQL Aggregate.GLOBAL"/>
   <node name="VM" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="FTB_ACTIVITY_BASE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FT_ALL_APPOINTMENT_EP" type="IKM" km="IKM Oracle Control Append for BDFL (multi-partition).BDFL_AMP">
      <option name="INSERT" value="true" default="true"/>
      <option name="COMMIT" value="true" default="true"/>
      <option name="SYNC_JRN_DELETE" value="true" default="true"/>
      <option name="FLOW_CONTROL" value="false" default="false"/>
      <option name="RECYCLE_ERRORS" value="false" default="true"/>
      <option name="STATIC_CONTROL" value="false" default="true"/>
      <option name="TRUNCATE" value="true" default="true"/>
      <option name="DELETE_ALL" value="false" default="true"/>
      <option name="CREATE_TARG_TABLE" value="true" default="true"/>
      <option name="DELETE_TEMPORARY_OBJECTS" value="true" default="true"/>
      <option name="FLOW_TABLE_OPTIONS" value="NOLOGGING" default="true"/>
      <option name="CREATE_FLOW_INDEX" value="true" default="true"/>
      <option name="COMPATIBLE" value="9" default="true"/>
      <option name="VALIDATE" value="false" default="true"/>
      <option name="ANALYZE_TARGET" value="false" default="true"/>
      <option name="HINT_SELECT" value=" " default="true"/>
      <option name="HINT_INSERT_FLOW" value="APPEND" default="true"/>
      <option name="HINT_INSERT_TARGET" value="APPEND" default="true"/>
      <option name="CONSTRAINTS" value="None" default="true"/>
      <option name="INDEXES" value="None" default="true"/>
      <option name="FILTER_PARTITION" value="true" default="true"/>
      <option name="HINT_SELECT_TARGET" value="" default="true"/>
   </node>
   <node name="FT_ALL_APPOINTMENT_EP" type="CKM" km="CKM Oracle for Amplifon.BDFL_AMP">
      <option name="DROP_ERROR_TABLE" value="true" default="true"/>
      <option name="DROP_CHECK_TABLE" value="false" default="true"/>
      <option name="CREATE_ERROR_INDEX" value="true" default="true"/>
      <option name="CREATE_FLOW_INDEX" value="true" default="true"/>
      <option name="COMPATIBLE" value="9" default="true"/>
      <option name="VALIDATE" value="false" default="true"/>
      <option name="ENABLE_EDITION_SUPPORT" value="false" default="true"/>
      <option name="UPGRADE_ERROR_TABLE" value="false" default="true"/>
      <option name="FILTER_CURRENT_FL" value="true" default="true"/>
      <option name="ENABLE_DATA_QUALITY" value="true" default="true"/>
   </node>
   <node name="FILTER2" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="EXPRESSION1_1" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="JOIN3_1" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="JOIN2" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="JOIN1_1" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="JOIN_1" type="XKM" km="XKM SQL Join.GLOBAL"/>
   <node name="EXPRESSION_1" type="XKM" km="XKM SQL Expression.GLOBAL"/>
   <node name="FT_ALL_APPOINTMENTS_TT_ES" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FILTER_AP" type="LKM" km="LKM Oracle to Oracle Pull (DB Link).GLOBAL">
      <option name="SELECT_FROM_SOURCE_VIEW" value="false" default="true"/>
      <option name="USE_STAGE_TABLE" value="false" default="true"/>
      <option name="ADD_DRIVING_SITE_HINT" value="false" default="true"/>
      <option name="CREATE_DB_LINK" value="true" default="true"/>
      <option name="SOURCE_ACCESS_DB_LINK" value="" default="true"/>
   </node>
   <node name="FILTER_1" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="FILTER1_1" type="XKM" km="XKM SQL Filter.GLOBAL"/>
   <node name="CF_LAST_SALE_AGING_RANGE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="DM_CLC_STATUS" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="UM_AG_S_SERVICE" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <node name="FT_TEST_ACTIVITY" type="XKM" km="XKM Oracle Extract.GLOBAL">
      <option name="CUSTOM_TEMPLATE" value=" " default="true"/>
      <option name="SELECT_HINT" value=" " default="true"/>
   </node>
   <target name="FT_ALL_APPOINTMENTS" resource="FT_ALL_APPOINTMENTS" model="DMM_BDL" logicalSchema="LOG_BDFL_DMM" forcedContext=""/>
</map-generation-info>]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[a6019f77-e8a8-4ead-9323-a3e1442cfe5e]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String"><![CDATA[DMM_BDL]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ResName" type="java.lang.String"><![CDATA[FT_ALL_APPOINTMENTS]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[MAP_ES_FT_ALL_APPOINTMENTS_02]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[M]]></Field>
	<Field name="TableName" type="java.lang.String"><![CDATA[FT_ALL_APPOINTMENTS]]></Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String">null</Field>
	<Field name="VarOp" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[a3d1c21b-d633-479f-80dc-296498f3cb5a]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_BEGIN]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[8600da11-274b-4432-a647-eb720ed69a2f]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("TRUE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[6053c206-5f24-4f5a-8bda-ba1a6e88c0ca]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Prepare: drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[79b818bd-422c-4ffb-8e51-7419326b8dfc]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_MAIN]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[18a41f05-3eb6-49cb-a504-6f2d81b361f6]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("TRUE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
String srcUserName = odiRef.getInfo("SRC_USER_NAME");
String srcServerInstance = odiRef.getInfo("SRC_DSERV_NAME");
String srcSID = "";
if (srcServerInstance != null && srcServerInstance.trim().length() != 0) {
  srcSID = srcServerInstance;
} else {
  String srcJDBCURL = odiRef.getInfo("SRC_JAVA_URL");
  if (srcJDBCURL !=null && srcJDBCURL.trim().length() != 0) {
    srcSID = srcJDBCURL.substring(srcJDBCURL.lastIndexOf("@") + 1);
    srcSID = srcSID.substring(srcSID.lastIndexOf(":") + 1);
    if (srcSID.lastIndexOf("/") >= 0){
      srcSID = srcSID.substring(srcSID.lastIndexOf("/") + 1);
    }
  }
}
srcSID = srcSID.trim();
if (srcSID.length() == 0) {
  throw new OdiKMException("Failed calculating source SID.");
}
?>
create database link <?=dblinkToSrc ?> connect to <?=srcUserName ?> identified by <@=odiRef.getInfo("SRC_PASS") @> using '<?=srcSID ?>'
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[99f0828a-5dad-4512-9b30-4f0e7f2abaf2]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Create database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[28c52492-4674-4008-9b29-18a225255a1f]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EB]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_BDFL_DMM_UNIT_1]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[/*commit*/ ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[0cac3aea-8869-428e-be08-1187252c6217]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[270]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[150]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Commit transaction]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[abcf0758-1810-4b06-a06b-9b62a8b87027]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[260]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Enable constraints]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[16074e98-d7e9-401b-8820-8033502bf21d]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[230]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[110]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Disable indexes]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[ea17e95f-e657-480a-b475-3e107f396b00]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[220]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[100]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Disable constraints]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[create table <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS", "LOG_BDFL_DMM", "D") ?>
(
	X_AUD_DATASOURCE_ID	NUMBER NULL,
	X_AUD_SESSION_ID	NUMBER NULL,
	X_AUD_FROM_TS	TIMESTAMP(6) NULL,
	X_AUD_TO_TS	TIMESTAMP(6) NULL,
	X_AUD_CURRENT_FL	NUMBER NULL,
	X_AUD_AGENT_CD	VARCHAR2(100 CHAR) NULL,
	X_AUD_INSERT_TS	TIMESTAMP(6) NULL,
	X_AUD_UPDATE_TS	TIMESTAMP(6) NULL,
	X_AUD_COMPANY_CD	VARCHAR2(3 CHAR) NULL,
	COMPANY_CD	VARCHAR2(63 CHAR) NULL,
	DIVISION_CD	VARCHAR2(63 CHAR) NULL,
	SHOP_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_ID	VARCHAR2(63 CHAR) NULL,
	LAPTOP_CD	VARCHAR2(63 CHAR) NULL,
	COMPANY_HK	VARCHAR2(63 CHAR) NULL,
	SHOP_HK	VARCHAR2(63 CHAR) NULL,
	CUSTOMER_HK	VARCHAR2(63 CHAR) NULL,
	LOCATION_TYPE_HK	VARCHAR2(63 CHAR) NULL,
	CLC_STATUS_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_MARKETING_LIST_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_RESULT_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_TM_MARKETING_LIST_HK	VARCHAR2(63 CHAR) NULL,
	CRM_LAST_TM_RESULT_HK	VARCHAR2(63 CHAR) NULL,
	ENR_LAST_NBA_HK	VARCHAR2(63 CHAR) NULL,
	CTB_CONTACTABILITY_HK	VARCHAR2(63 CHAR) NULL,
	INT_LAST_INTERACTION_HK	VARCHAR2(63 CHAR) NULL,
	TST_LAST_TEST_HK	VARCHAR2(63 CHAR) NULL,
	TRI_LAST_TRIAL_HK	VARCHAR2(63 CHAR) NULL,
	COM_LAST_SALE_HK	VARCHAR2(63 CHAR) NULL,
	EMPLOYEE_HK	VARCHAR2(63 CHAR) NULL,
	SERVICE_APPOINTMENT_HK	VARCHAR2(63 CHAR) NULL,
	MEDIATYPE_HK	VARCHAR2(63 CHAR) NULL,
	CAMPAIGN_HK	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_BOOKING_SK	NUMBER NULL,
	APPOINTMENT_SCHEDULING_SK	NUMBER NULL,
	APPOINTMENT_DURATION_QT	NUMBER NULL,
	APPOINTMENT_SHOP_CD	VARCHAR2(63 CHAR) NULL,
	CAMPAING_CD	VARCHAR2(63 CHAR) NULL,
	MEDIATYPE_CD	VARCHAR2(63 CHAR) NULL,
	RESULT_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_BOOKING_DT	DATE NULL,
	APPOINTMENT_SCHEDULING_DT	DATE NULL,
	APPOINTMENT_STATUS_CD	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_ID_REF	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_DT_REF	DATE NULL,
	D_LAST_SALE_HOT_COLD_DT	DATE NULL,
	D_CLC_REFERENCE_DATE_DT	DATE NULL,
	APPOINTMENT_ID_LEAF	VARCHAR2(63 CHAR) NULL,
	APPOINTMENT_DT_LEAF	DATE NULL,
	APPOINTMENT_RESCHEDULATIONS_QT	NUMBER NULL,
	REASON_CLOSING_CD	VARCHAR2(63 CHAR) NULL,
	RESCHEDULING_RELATIONSHIP_DS	VARCHAR2(63 CHAR) NULL,
	INVOICING_APP_FL	NUMBER NULL,
	INVOICING_APP_AMOUNT_QT	NUMBER NULL,
	INVOICING_APP_UNITS	NUMBER NULL,
	M_FROM_CALL_CENTER_FL	NUMBER NULL,
	M_FROM_WEB_FL	NUMBER NULL,
	M_FROM_SHOP_FL	NUMBER NULL,
	M_COMPLETED_FL	NUMBER NULL,
	M_FUTURE_APPOINTMENT_FL	NUMBER NULL,
	M_SCHEDULED_APPOINTMENT_FL	NUMBER NULL,
	M_CLIENT_ID	VARCHAR2(63 CHAR) NULL,
	M458_TIME_TO_APPOINTMENT_QT	NUMBER NULL,
	M_AGENDA_APPOINTMENTS_FL	NUMBER NULL,
	M_CANCELED_FL	NUMBER NULL,
	TEST_AGEING_SK	NUMBER NULL,
	INTERACTION_AGEING_SK	NUMBER NULL,
	D_CANCELLATION_DATE_DT	DATE NULL,
	MEDICAL_MEDIATYPE_HK	VARCHAR2(63 CHAR) NULL,
	M_OPPT_APP_FL	NUMBER NULL
)  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d2f283dd-cbb4-4e93-92f1-f268ddf327f8]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[80]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Create target table ]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[5f5ecb12-f78a-4d30-95d2-fffb24260df4]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[250]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[130]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Enable indexes]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[alter table <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS", "LOG_BDFL_DMM", "D") ?> truncate partition (#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET)  ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[0fafb68d-7437-4414-b841-b097da610aed]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Truncate target table partition]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[ 
insert /*+ APPEND */ into	<?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS", "LOG_BDFL_DMM", "D") ?>
 PARTITION(#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET)
( 
	X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_ID_REF,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	APPOINTMENT_ID_LEAF,
	APPOINTMENT_DT_LEAF,
	APPOINTMENT_RESCHEDULATIONS_QT,
	REASON_CLOSING_CD,
	RESCHEDULING_RELATIONSHIP_DS,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL 
) 
select /*+  */
    X_AUD_DATASOURCE_ID,
	X_AUD_SESSION_ID,
	X_AUD_FROM_TS,
	X_AUD_TO_TS,
	X_AUD_CURRENT_FL,
	X_AUD_AGENT_CD,
	X_AUD_INSERT_TS,
	X_AUD_UPDATE_TS,
	X_AUD_COMPANY_CD,
	COMPANY_CD,
	DIVISION_CD,
	SHOP_CD,
	APPOINTMENT_ID,
	LAPTOP_CD,
	COMPANY_HK,
	SHOP_HK,
	CUSTOMER_HK,
	LOCATION_TYPE_HK,
	CLC_STATUS_HK,
	CRM_LAST_MARKETING_LIST_HK,
	CRM_LAST_RESULT_HK,
	CRM_LAST_TM_MARKETING_LIST_HK,
	CRM_LAST_TM_RESULT_HK,
	ENR_LAST_NBA_HK,
	CTB_CONTACTABILITY_HK,
	INT_LAST_INTERACTION_HK,
	TST_LAST_TEST_HK,
	TRI_LAST_TRIAL_HK,
	COM_LAST_SALE_HK,
	EMPLOYEE_HK,
	SERVICE_APPOINTMENT_HK,
	MEDIATYPE_HK,
	CAMPAIGN_HK,
	APPOINTMENT_BOOKING_SK,
	APPOINTMENT_SCHEDULING_SK,
	APPOINTMENT_DURATION_QT,
	APPOINTMENT_SHOP_CD,
	CAMPAING_CD,
	MEDIATYPE_CD,
	RESULT_CD,
	APPOINTMENT_BOOKING_DT,
	APPOINTMENT_SCHEDULING_DT,
	APPOINTMENT_STATUS_CD,
	APPOINTMENT_ID_REF,
	APPOINTMENT_DT_REF,
	D_LAST_SALE_HOT_COLD_DT,
	D_CLC_REFERENCE_DATE_DT,
	APPOINTMENT_ID_LEAF,
	APPOINTMENT_DT_LEAF,
	APPOINTMENT_RESCHEDULATIONS_QT,
	REASON_CLOSING_CD,
	RESCHEDULING_RELATIONSHIP_DS,
	INVOICING_APP_FL,
	INVOICING_APP_AMOUNT_QT,
	INVOICING_APP_UNITS,
	M_FROM_CALL_CENTER_FL,
	M_FROM_WEB_FL,
	M_FROM_SHOP_FL,
	M_COMPLETED_FL,
	M_FUTURE_APPOINTMENT_FL,
	M_SCHEDULED_APPOINTMENT_FL,
	M_CLIENT_ID,
	M458_TIME_TO_APPOINTMENT_QT,
	M_AGENDA_APPOINTMENTS_FL,
	M_CANCELED_FL,
	TEST_AGEING_SK,
	INTERACTION_AGEING_SK,
	D_CANCELLATION_DATE_DT,
	MEDICAL_MEDIATYPE_HK,
	M_OPPT_APP_FL   
FROM (	
select 	
	4 X_AUD_DATASOURCE_ID,
	#BDFL_AMP.V_SESSION_NO X_AUD_SESSION_ID,
	TO_TIMESTAMP('01/01/1900','DD/MM/YYYY HH24:MI:SS') X_AUD_FROM_TS,
	TO_TIMESTAMP('31/12/9999','DD/MM/YYYY HH24:MI:SS') X_AUD_TO_TS,
	1 X_AUD_CURRENT_FL,
	'MAP_ES_FT_ALL_APPOINTMENTS_02' || ' (' || '<?=odiRef.getContext("CTX_CODE") ?>' || ')' X_AUD_AGENT_CD,
	SYSTIMESTAMP X_AUD_INSERT_TS,
	SYSTIMESTAMP X_AUD_UPDATE_TS,
	INLINE_VIEW_2.COMPANY_CD_1 X_AUD_COMPANY_CD,
	INLINE_VIEW_2.COMPANY_CD_1 COMPANY_CD,
	INLINE_VIEW_2.DIVISION_CD_1 DIVISION_CD,
	INLINE_VIEW_2.SHOP_CD SHOP_CD,
	INLINE_VIEW_2.APPOINTMENT_ID APPOINTMENT_ID,
	INLINE_VIEW_2.LAPTOP_CD LAPTOP_CD,
	INLINE_VIEW_2.COMPANY_HK COMPANY_HK,
	INLINE_VIEW_2.SHOP_HK SHOP_HK,
	INLINE_VIEW_2.CUSTOMER_HK CUSTOMER_HK,
	INLINE_VIEW_2.LOCATION_TYPE_HK LOCATION_TYPE_HK,
	INLINE_VIEW_2.CLC_STATUS_HK_1 CLC_STATUS_HK,
	INLINE_VIEW_2.CRM_LAST_MARKETING_LIST_HK CRM_LAST_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_RESULT_HK CRM_LAST_RESULT_HK,
	INLINE_VIEW_2.CRM_LAST_TM_MARKETING_LIST_HK CRM_LAST_TM_MARKETING_LIST_HK,
	INLINE_VIEW_2.CRM_LAST_TM_RESULT_HK CRM_LAST_TM_RESULT_HK,
	INLINE_VIEW_2.ENR_LAST_NBA_HK ENR_LAST_NBA_HK,
	INLINE_VIEW_2.CTB_CONTACTABILITY_HK CTB_CONTACTABILITY_HK,
	INLINE_VIEW_2.INT_LAST_INTERACTION_HK INT_LAST_INTERACTION_HK,
	INLINE_VIEW_2.TST_LAST_TEST_HK TST_LAST_TEST_HK,
	INLINE_VIEW_2.TRI_LAST_TRIAL_HK TRI_LAST_TRIAL_HK,
	INLINE_VIEW_2.COM_LAST_SALE_HK COM_LAST_SALE_HK,
	INLINE_VIEW_2.EMPLOYEE_HK EMPLOYEE_HK,
	INLINE_VIEW_2.SERVICE_APPOINTMENT_HK SERVICE_APPOINTMENT_HK,
	INLINE_VIEW_2.MEDIATYPE_HK MEDIATYPE_HK,
	INLINE_VIEW_2.CAMPAIGN_HK CAMPAIGN_HK,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_SK APPOINTMENT_BOOKING_SK,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_SK APPOINTMENT_SCHEDULING_SK,
	INLINE_VIEW_2.APPOINTMENT_DURATION_QT APPOINTMENT_DURATION_QT,
	INLINE_VIEW_2.APPOINTMENT_SHOP_CD APPOINTMENT_SHOP_CD,
	INLINE_VIEW_2.CAMPAING_CD CAMPAING_CD,
	INLINE_VIEW_2.MEDIATYPE_CD MEDIATYPE_CD,
	INLINE_VIEW_2.RESULT_CD RESULT_CD,
	INLINE_VIEW_2.APPOINTMENT_BOOKING_DT APPOINTMENT_BOOKING_DT,
	INLINE_VIEW_2.APPOINTMENT_SCHEDULING_DT APPOINTMENT_SCHEDULING_DT,
	INLINE_VIEW_2.APPOINTMENT_STATUS_CD APPOINTMENT_STATUS_CD,
	INLINE_VIEW_2.APPOINTMENT_ID_REF APPOINTMENT_ID_REF,
	INLINE_VIEW_2.APPOINTMENT_DT_REF APPOINTMENT_DT_REF,
	INLINE_VIEW_2.D_LAST_SALE_HOT_COLD_DT D_LAST_SALE_HOT_COLD_DT,
	INLINE_VIEW_2.D_CLC_REFERENCE_DATE_DT D_CLC_REFERENCE_DATE_DT,
	INLINE_VIEW_2.APPOINTMENT_ID_LEAF APPOINTMENT_ID_LEAF,
	INLINE_VIEW_2.APPOINTMENT_DT_LEAF APPOINTMENT_DT_LEAF,
	INLINE_VIEW_2.APPOINTMENT_RESCHEDULATIONS_QT APPOINTMENT_RESCHEDULATIONS_QT,
	INLINE_VIEW_2.REASON_CLOSING_CD REASON_CLOSING_CD,
	CASE WHEN
INLINE_VIEW_2.APPOINTMENT_RESCHEDULATIONS_QT = 0 THEN 'ISOLATED'
WHEN INLINE_VIEW_2.APPOINTMENT_ID = INLINE_VIEW_2.APPOINTMENT_ID_REF THEN 'FATHER'
ELSE 'SON'
END RESCHEDULING_RELATIONSHIP_DS,
	INLINE_VIEW_2.INVOICING_APP_FL INVOICING_APP_FL,
	INLINE_VIEW_2.INVOICING_APP_AMOUNT_QT INVOICING_APP_AMOUNT_QT,
	INLINE_VIEW_2.INVOICING_APP_UNITS INVOICING_APP_UNITS,
	INLINE_VIEW_2.M_FROM_CALL_CENTER_FL M_FROM_CALL_CENTER_FL,
	INLINE_VIEW_2.M_FROM_WEB_FL M_FROM_WEB_FL,
	INLINE_VIEW_2.M_FROM_SHOP_FL M_FROM_SHOP_FL,
	INLINE_VIEW_2.M_COMPLETED_FL M_COMPLETED_FL,
	INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL M_FUTURE_APPOINTMENT_FL,
	INLINE_VIEW_2.M_SCHEDULED_APPOINTMENT_FL M_SCHEDULED_APPOINTMENT_FL,
	INLINE_VIEW_2.M_CLIENT_ID M_CLIENT_ID,
	INLINE_VIEW_2.M458_TIME_TO_APPOINTMENT_QT M458_TIME_TO_APPOINTMENT_QT,
	INLINE_VIEW_2.M_AGENDA_APPOINTMENTS_FL M_AGENDA_APPOINTMENTS_FL,
	INLINE_VIEW_2.M_CANCELED_FL M_CANCELED_FL,
	INLINE_VIEW_2.TEST_AGEING_SK TEST_AGEING_SK,
	INLINE_VIEW_2.INTERACTION_AGEING_SK INTERACTION_AGEING_SK,
	INLINE_VIEW_2.D_CANCELLATION_DATE_DT D_CANCELLATION_DATE_DT,
	CASE
  WHEN (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END) IS NOT NULL
  THEN STANDARD_HASH(INLINE_VIEW_2.COMPANY_CD_1 || INLINE_VIEW_2.DIVISION_CD_1 || (CASE WHEN  (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD NOT IN  ('05', '06') THEN 'F_VM'
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'S' AND   INLINE_VIEW_2.MEDIATYPE_CD   IN  ('05', '06') THEN INLINE_VIEW_2.MEDIATYPE_CD 
  WHEN (CASE WHEN  INLINE_VIEW_2.MEDIATYPE_CD  IN ('05', '06') THEN 'S'
  WHEN FTB_ACTIVITY_BASE_1.COMPANY_CD IS NOT NULL THEN 'S'
  WHEN INLINE_VIEW_2.MEDIATYPE_CD = '31' THEN 'O'
  ELSE 'N' END) = 'O' AND INLINE_VIEW_2.MEDIATYPE_CD  = '31' THEN INLINE_VIEW_2.MEDIATYPE_CD 
  ELSE INLINE_VIEW_2.MEDIATYPE_CD  END)  )
  ELSE STANDARD_HASH ('-1')
END MEDICAL_MEDIATYPE_HK,
	CASE
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR IS NULL AND  INLINE_VIEW_2.SERVICE_TYPE_CODE IN ('00','02','04') THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 4 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D186_CUSTOMER_TYPE_PR = 5 AND INLINE_VIEW_2.M_HEARING_LOSS_FL = 1 AND INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 1 AND INLINE_VIEW_2.M_FUTURE_APPOINTMENT_FL = 1 THEN 1
    WHEN INLINE_VIEW_2.D202_CUSTOMER_TYPE_GROUP_PR = 3 AND INLINE_VIEW_2.AGING_CLUSTER_CD = 2 AND  INLINE_VIEW_2.SERVICE_TYPE_CODE <> '01' THEN 1
    ELSE 0
END M_OPPT_APP_FL 
from	(
SELECT 
  FTB_ACTIVITY_BASE.COMPANY_CD AS COMPANY_CD ,
  FTB_ACTIVITY_BASE.DIVISION_CD AS DIVISION_CD ,
  FTB_ACTIVITY_BASE.CUSTOMER_CD AS CUSTOMER_CD   
FROM 
  <?= odiRef.getObjectName("L", "FTB_ACTIVITY_BASE", "LOG_BDFL", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> FTB_ACTIVITY_BASE  
WHERE
  ((FTB_ACTIVITY_BASE.DIVISION_CD = '001' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM') 
OR (FTB_ACTIVITY_BASE.DIVISION_CD = '002' AND FTB_ACTIVITY_BASE.ACTIVITY_TYPE_CD = 'VM' AND  TRUNC(FTB_ACTIVITY_BASE.ACTIVITY_DATE_DT) >= to_date('2019-01-01','yyyy-mm-dd'))
) 
GROUP BY
  FTB_ACTIVITY_BASE.COMPANY_CD,FTB_ACTIVITY_BASE.DIVISION_CD,FTB_ACTIVITY_BASE.CUSTOMER_CD 
  ) FTB_ACTIVITY_BASE_1  RIGHT OUTER JOIN  (
SELECT 
  INLINE_VIEW_1.COMPANY_CD AS COMPANY_CD ,
  INLINE_VIEW_1.DIVISION_CD AS DIVISION_CD ,
  INLINE_VIEW_1.AGE_CD AS AGE_CD ,
  INLINE_VIEW_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW_1.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW_1.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW_1.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW_1.COMPANY_CD_1 AS COMPANY_CD_1 ,
  INLINE_VIEW_1.DIVISION_CD_1 AS DIVISION_CD_1 ,
  INLINE_VIEW_1.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW_1.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW_1.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW_1.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW_1.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW_1.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW_1.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW_1.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW_1.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW_1.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW_1.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW_1.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW_1.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW_1.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW_1.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW_1.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW_1.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW_1.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW_1.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW_1.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW_1.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW_1.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW_1.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW_1.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW_1.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW_1.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW_1.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW_1.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW_1.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW_1.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW_1.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW_1.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW_1.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW_1.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW_1.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW_1.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW_1.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW_1.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW_1.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW_1.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW_1.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW_1.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW_1.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW_1.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW_1.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW_1.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW_1.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW_1.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW_1.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW_1.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW_1.COL AS COL ,
  INLINE_VIEW_1.COMPANY_CODE AS COMPANY_CODE ,
  INLINE_VIEW_1.DIVISION_CODE AS DIVISION_CODE ,
  INLINE_VIEW_1.SERVICE_CODE AS SERVICE_CODE ,
  INLINE_VIEW_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  INLINE_VIEW_1.COMPANY_CD_2 AS COMPANY_CD_2 ,
  INLINE_VIEW_1.DIVISION_CD_2 AS DIVISION_CD_2 ,
  INLINE_VIEW_1.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  INLINE_VIEW_1.CUSTOMER_HK_1 AS CUSTOMER_HK_1 ,
  INLINE_VIEW_1.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  INLINE_VIEW_1.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  INLINE_VIEW_1.COL_1 AS COL_1   
FROM 
  (
SELECT 
  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE_1.AGING_CLUSTER_CD AS AGING_CLUSTER_CD ,
  INLINE_VIEW.CLC_STATUS_HK AS CLC_STATUS_HK ,
  INLINE_VIEW.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  INLINE_VIEW.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  INLINE_VIEW.COMPANY_CD AS COMPANY_CD_1 ,
  INLINE_VIEW.DIVISION_CD AS DIVISION_CD_1 ,
  INLINE_VIEW.SHOP_CD AS SHOP_CD ,
  INLINE_VIEW.APPOINTMENT_ID AS APPOINTMENT_ID ,
  INLINE_VIEW.LAPTOP_CD AS LAPTOP_CD ,
  INLINE_VIEW.COMPANY_HK AS COMPANY_HK ,
  INLINE_VIEW.SHOP_HK AS SHOP_HK ,
  INLINE_VIEW.CUSTOMER_HK AS CUSTOMER_HK ,
  INLINE_VIEW.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  INLINE_VIEW.CLC_STATUS_HK_1 AS CLC_STATUS_HK_1 ,
  INLINE_VIEW.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  INLINE_VIEW.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  INLINE_VIEW.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  INLINE_VIEW.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  INLINE_VIEW.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  INLINE_VIEW.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  INLINE_VIEW.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  INLINE_VIEW.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  INLINE_VIEW.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  INLINE_VIEW.EMPLOYEE_HK AS EMPLOYEE_HK ,
  INLINE_VIEW.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  INLINE_VIEW.MEDIATYPE_HK AS MEDIATYPE_HK ,
  INLINE_VIEW.CAMPAIGN_HK AS CAMPAIGN_HK ,
  INLINE_VIEW.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  INLINE_VIEW.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  INLINE_VIEW.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  INLINE_VIEW.CAMPAING_CD AS CAMPAING_CD ,
  INLINE_VIEW.MEDIATYPE_CD AS MEDIATYPE_CD ,
  INLINE_VIEW.RESULT_CD AS RESULT_CD ,
  INLINE_VIEW.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  INLINE_VIEW.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  INLINE_VIEW.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  INLINE_VIEW.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  INLINE_VIEW.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  INLINE_VIEW.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  INLINE_VIEW.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  INLINE_VIEW.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  INLINE_VIEW.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  INLINE_VIEW.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  INLINE_VIEW.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  INLINE_VIEW.INVOICING_APP_FL AS INVOICING_APP_FL ,
  INLINE_VIEW.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  INLINE_VIEW.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  INLINE_VIEW.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  INLINE_VIEW.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  INLINE_VIEW.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  INLINE_VIEW.M_COMPLETED_FL AS M_COMPLETED_FL ,
  INLINE_VIEW.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  INLINE_VIEW.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  INLINE_VIEW.M_CLIENT_ID AS M_CLIENT_ID ,
  INLINE_VIEW.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  INLINE_VIEW.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  INLINE_VIEW.M_CANCELED_FL AS M_CANCELED_FL ,
  INLINE_VIEW.TEST_AGEING_SK AS TEST_AGEING_SK ,
  INLINE_VIEW.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  INLINE_VIEW.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  INLINE_VIEW.COL AS COL ,
  UM_AG_S_SERVICE_1.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE_1.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE_1.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE ,
  FT_TEST_ACTIVITY.COMPANY_CD AS COMPANY_CD_2 ,
  FT_TEST_ACTIVITY.DIVISION_CD AS DIVISION_CD_2 ,
  FT_TEST_ACTIVITY.ACTIVITY_DATE_DT AS ACTIVITY_DATE_DT ,
  FT_TEST_ACTIVITY.CUSTOMER_HK AS CUSTOMER_HK_1 ,
  FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT AS D_ACTIVITY_TEST_DATE_DT ,
  FT_TEST_ACTIVITY.M_HEARING_LOSS_FL AS M_HEARING_LOSS_FL ,
  ROW_NUMBER() OVER (PARTITION BY 
INLINE_VIEW.COMPANY_CD,
INLINE_VIEW.DIVISION_CD,
INLINE_VIEW.SHOP_CD,
INLINE_VIEW.APPOINTMENT_ID,
INLINE_VIEW.LAPTOP_CD,
INLINE_VIEW.CUSTOMER_HK
ORDER BY FT_TEST_ACTIVITY.D_ACTIVITY_TEST_DATE_DT DESC) AS COL_1   
FROM 
  ((
SELECT 
  CF_LAST_SALE_AGING_RANGE.COMPANY_CD AS COMPANY_CD ,
  CF_LAST_SALE_AGING_RANGE.DIVISION_CD AS DIVISION_CD ,
  CF_LAST_SALE_AGING_RANGE.AGE_CD AS AGE_CD ,
  CF_LAST_SALE_AGING_RANGE.AGING_CLUSTER_CD AS AGING_CLUSTER_CD   
FROM 
  <?= odiRef.getObjectName("L", "CF_LAST_SALE_AGING_RANGE", "LOG_BDFL_DMM", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE") ?> CF_LAST_SALE_AGING_RANGE  
WHERE
  (CF_LAST_SALE_AGING_RANGE.COMPANY_CD = '002'
) 
  ) CF_LAST_SALE_AGING_RANGE_1  RIGHT OUTER JOIN  ((
SELECT 
  UM_AG_S_SERVICE.COMPANY_CODE AS COMPANY_CODE ,
  UM_AG_S_SERVICE.DIVISION_CODE AS DIVISION_CODE ,
  UM_AG_S_SERVICE.SERVICE_CODE AS SERVICE_CODE ,
  UM_AG_S_SERVICE.SERVICE_TYPE_CODE AS SERVICE_TYPE_CODE   
FROM 
  <?= odiRef.getObjectName("L", "UM_AG_S_SERVICE", "LOG_EDW", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE") ?> UM_AG_S_SERVICE  
WHERE
  (UM_AG_S_SERVICE.COMPANY_CODE = '002'
AND UM_AG_S_SERVICE.X_AUD_CURRENT_FL = 1
) 
  ) UM_AG_S_SERVICE_1  RIGHT OUTER JOIN  (
SELECT 
  DM_CLC_STATUS.CLC_STATUS_HK AS CLC_STATUS_HK ,
  DM_CLC_STATUS.D186_CUSTOMER_TYPE_PR AS D186_CUSTOMER_TYPE_PR ,
  DM_CLC_STATUS.D202_CUSTOMER_TYPE_GROUP_PR AS D202_CUSTOMER_TYPE_GROUP_PR ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_CD AS COMPANY_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.DIVISION_CD AS DIVISION_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_CD AS SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_ID AS APPOINTMENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.LAPTOP_CD AS LAPTOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.COMPANY_HK AS COMPANY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SHOP_HK AS SHOP_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CUSTOMER_HK AS CUSTOMER_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.LOCATION_TYPE_HK AS LOCATION_TYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK AS CLC_STATUS_HK_1 ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_MARKETING_LIST_HK AS CRM_LAST_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_RESULT_HK AS CRM_LAST_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_MARKETING_LIST_HK AS CRM_LAST_TM_MARKETING_LIST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CRM_LAST_TM_RESULT_HK AS CRM_LAST_TM_RESULT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.ENR_LAST_NBA_HK AS ENR_LAST_NBA_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CTB_CONTACTABILITY_HK AS CTB_CONTACTABILITY_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.INT_LAST_INTERACTION_HK AS INT_LAST_INTERACTION_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TST_LAST_TEST_HK AS TST_LAST_TEST_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.TRI_LAST_TRIAL_HK AS TRI_LAST_TRIAL_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.COM_LAST_SALE_HK AS COM_LAST_SALE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.EMPLOYEE_HK AS EMPLOYEE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.SERVICE_APPOINTMENT_HK AS SERVICE_APPOINTMENT_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_HK AS MEDIATYPE_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAIGN_HK AS CAMPAIGN_HK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_SK AS APPOINTMENT_BOOKING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_SK AS APPOINTMENT_SCHEDULING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DURATION_QT AS APPOINTMENT_DURATION_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SHOP_CD AS APPOINTMENT_SHOP_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.CAMPAING_CD AS CAMPAING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.MEDIATYPE_CD AS MEDIATYPE_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.RESULT_CD AS RESULT_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_BOOKING_DT AS APPOINTMENT_BOOKING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT AS APPOINTMENT_SCHEDULING_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_STATUS_CD AS APPOINTMENT_STATUS_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_ID_REF AS APPOINTMENT_ID_REF ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DT_REF AS APPOINTMENT_DT_REF ,
  FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS D_LAST_SALE_HOT_COLD_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CLC_REFERENCE_DATE_DT AS D_CLC_REFERENCE_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_ID_LEAF AS APPOINTMENT_ID_LEAF ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_DT_LEAF AS APPOINTMENT_DT_LEAF ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_RESCHEDULATIONS_QT AS APPOINTMENT_RESCHEDULATIONS_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.REASON_CLOSING_CD AS REASON_CLOSING_CD ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_FL AS INVOICING_APP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_AMOUNT_QT AS INVOICING_APP_AMOUNT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.INVOICING_APP_UNITS AS INVOICING_APP_UNITS ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_CALL_CENTER_FL AS M_FROM_CALL_CENTER_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_WEB_FL AS M_FROM_WEB_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FROM_SHOP_FL AS M_FROM_SHOP_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_COMPLETED_FL AS M_COMPLETED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_FUTURE_APPOINTMENT_FL AS M_FUTURE_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_SCHEDULED_APPOINTMENT_FL AS M_SCHEDULED_APPOINTMENT_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CLIENT_ID AS M_CLIENT_ID ,
  FT_ALL_APPOINTMENTS_TT_ES.M458_TIME_TO_APPOINTMENT_QT AS M458_TIME_TO_APPOINTMENT_QT ,
  FT_ALL_APPOINTMENTS_TT_ES.M_AGENDA_APPOINTMENTS_FL AS M_AGENDA_APPOINTMENTS_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.M_CANCELED_FL AS M_CANCELED_FL ,
  FT_ALL_APPOINTMENTS_TT_ES.TEST_AGEING_SK AS TEST_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.INTERACTION_AGEING_SK AS INTERACTION_AGEING_SK ,
  FT_ALL_APPOINTMENTS_TT_ES.D_CANCELLATION_DATE_DT AS D_CANCELLATION_DATE_DT ,
  FT_ALL_APPOINTMENTS_TT_ES.APPOINTMENT_SCHEDULING_DT - FT_ALL_APPOINTMENTS_TT_ES.D_LAST_SALE_HOT_COLD_DT AS COL   
FROM 
  <?= odiRef.getObjectName("L", "DM_CLC_STATUS", "LOG_BDFL_DMM", "D") ?> DM_CLC_STATUS  RIGHT OUTER JOIN  <?= odiRef.getObjectName("L", "FT_ALL_APPOINTMENTS_TT_ES", "LOG_STG_BDFL", "D") ?> FT_ALL_APPOINTMENTS_TT_ES  
    ON  FT_ALL_APPOINTMENTS_TT_ES.CLC_STATUS_HK = DM_CLC_STATUS.CLC_STATUS_HK
  ) INLINE_VIEW  
    ON  STANDARD_HASH(UM_AG_S_SERVICE_1.COMPANY_CODE||UM_AG_S_SERVICE_1.DIVISION_CODE||UM_AG_S_SERVICE_1.SERVICE_CODE) = INLINE_VIEW.SERVICE_APPOINTMENT_HK
     )  
    ON  CF_LAST_SALE_AGING_RANGE_1.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND CF_LAST_SALE_AGING_RANGE_1.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND CF_LAST_SALE_AGING_RANGE_1.AGE_CD = INLINE_VIEW.COL
     )  LEFT OUTER JOIN  <?= odiRef.getObjectName("L", "FT_TEST_ACTIVITY", "LOG_BDFL_DMM", "", "D", "P", "#BDFL_AMP.V_CONTEXT_PARTITION_CODE_TARGET") ?> FT_TEST_ACTIVITY  
    ON  FT_TEST_ACTIVITY.COMPANY_CD = INLINE_VIEW.COMPANY_CD
AND FT_TEST_ACTIVITY.DIVISION_CD = INLINE_VIEW.DIVISION_CD
AND FT_TEST_ACTIVITY.CUSTOMER_HK = INLINE_VIEW.CUSTOMER_HK
AND FT_TEST_ACTIVITY.ACTIVITY_DATE_DT < INLINE_VIEW.APPOINTMENT_SCHEDULING_DT
  ) INLINE_VIEW_1  
WHERE
  (INLINE_VIEW_1.COL_1 = 1
) 
  ) INLINE_VIEW_2  
    ON  FTB_ACTIVITY_BASE_1.COMPANY_CD =   INLINE_VIEW_2.COMPANY_CD_1
AND FTB_ACTIVITY_BASE_1.DIVISION_CD = INLINE_VIEW_2.DIVISION_CD_1
AND  STANDARD_HASH(FTB_ACTIVITY_BASE_1.COMPANY_CD || FTB_ACTIVITY_BASE_1.DIVISION_CD || FTB_ACTIVITY_BASE_1.CUSTOMER_CD ) = INLINE_VIEW_2.CUSTOMER_HK
where		(1=1)	
)  ODI_GET_FROM
   ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cffb40e9-9576-4a04-8491-65005f09b811]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String"><![CDATA[I]]></Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[240]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[120]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Insert new rows]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[IKM Oracle Control Append for BDFL (multi-partition)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[J]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cc2320e3-d78d-4bec-9edd-81a73bfd1de9]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[160]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[MAP_CLEANUP]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String">null</Field>
	<Field name="DefTxt" type="java.lang.String">null</Field>
	<Field name="ExeChannel" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[316b9d6b-cd73-4e7b-9b7d-b37ec9f37229]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[160]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[170]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[SERIAL]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[EU]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[LOG_EDW_UNIT]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[L]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="ColIsolLevel" type="java.lang.String"><![CDATA[D]]></Field>
	<Field name="ColLschemaName" type="java.lang.String"><![CDATA[LOG_EDW]]></Field>
	<Field name="ColTechIntName" type="java.lang.String">null</Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="DefIsolLevel" type="java.lang.String"><![CDATA[2]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[LOG_BDFL_DMM]]></Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[GENERIC_SQL]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[
<?
String dblinkToSrc = "";
if ("".equals(dblinkToSrc)) {
  dblinkToSrc = odiRef.getInfo("SRC_LSCHEMA_NAME");
}
if ("TRUE".equals("TRUE")) {
  dblinkToSrc += "%UNIQUE_SESSION_TAG";
}
dblinkToSrc = dblinkToSrc.replaceAll(" ","");
dblinkToSrc = dblinkToSrc.replaceAll("-","");
dblinkToSrc = odiRef.getFormattedName(dblinkToSrc);
?>
drop database link <?=dblinkToSrc ?>
       ]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[23b9ca2b-7344-4062-997e-6624bb441d98]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[5]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[MC]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[170]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[14845]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[180]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Drop database link to source]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[LKM Oracle to Oracle Pull (DB Link)]]></Field>
	<Field name="TaskName3" type="java.lang.String">null</Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[C]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_PACKAGE.9271]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[69ab267c-f1e2-479c-b2cb-f093b87e6897]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[BDFL_AMP.DMM_BDL_ES.PKG_BDL_ES_2_FT_ALL_APPOINTMENTS]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_FOLDER.SNP_PACKAGE]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[8.10.32]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCEN.14845]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[fc19948d-3afb-47bd-80c2-98652551d293]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[BDFL_AMP.DMM_BDL_ES.PKG_BDL_ES_2_FT_ALL_APPOINTMENTS.PKG_BDL_ES_2_FT_ALL_APPOINTMENTS Version 001]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_FOLDER.SNP_PACKAGE.SNP_SCEN]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[8.10.32.44]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_EXPTXTHEADER.65164]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[73cda650-902a-4b52-bbb9-2af04e044949]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.0]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[2bad9d93-0c64-422d-afc2-806099de2405]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.1]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[81a87c7f-e9d8-4ea5-b793-af3a0357b765]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.2]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[0a617d0a-15fd-42c4-ac99-a931e9de33c3]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.3]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[c8d08bad-f57a-436d-aa8c-ac9e7d968fb1]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.4]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[efb8aeb7-a78c-4d00-901c-795e9f069886]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.14845.5]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[a6019f77-e8a8-4ead-9323-a3e1442cfe5e]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpImportRep">
		<Field name="GlobalId" type="java.lang.String"><![CDATA[b0077bd8-1c01-492b-8c65-75d562351aca]]></Field>
	<Field name="RepGuid" type="java.lang.String">null</Field>
	<Field name="RepShortId" type="com.sunopsis.sql.DbInt"><![CDATA[11]]></Field>
	<Field name="RepTimestamp" type="java.lang.String"><![CDATA[1510079777723]]></Field>
</Object>
<Object class="com.sunopsis.dwg.DwgExportSummary">
		<Field name="ExpTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="InstObjNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="LinkDiagNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MorigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MtxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OrigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OtherObjectsNb" type="com.sunopsis.sql.DbInt"><![CDATA[111]]></Field>
	<Field name="PlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="StepNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="TxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="UeOrigNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="UeUsedNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="VarPlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OdiVersion" type="java.lang.String"><![CDATA[12.2.1]]></Field>
	<Field name="OriginRepositoryID" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="RepositoryVersion" type="java.lang.String"><![CDATA[05.02.02.09]]></Field>
</Object>
</SunopsisExport>
